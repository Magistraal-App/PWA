var _magistraalStorage={};const magistraalStorage={get:a=>{const t=_magistraalStorage[a]??void 0;return isSet(t)?t:{value:void 0,storedAt:Date.now()}},set:(a,t)=>{const e={value:t,storedAt:Date.now()};return _magistraalStorage[a]=e,!0},remove:a=>(isSet(_magistraalStorage[a])&&delete magistraalStorage[a],!0)},magistraalPersistentStorage={get:a=>{try{const t=JSON.parse(localStorage.getItem(`magistraal.${a}`));return isSet(t)?t:{value:void 0,storedAt:Date.now()}}catch(a){return{value:void 0,storedAt:Date.now()}}},set:(a,t)=>{const e={value:t,storedAt:Date.now()};return localStorage.setItem(`magistraal.${a}`,JSON.stringify(e))},remove:a=>magistraalPersistentStorage.set(a,void 0),clear:(a=!1)=>{let t=[];for(let e=0;e<localStorage.length;e++){let s=localStorage.key(e);"magistraal"==s.substring(0,10)&&("magistraal.version"!=s&&"magistraal.api_response.locale"!=s&&("magistraal.user_uuid"==s&&a||t.push(localStorage.key(e))))}for(let a=0;a<t.length;a++)localStorage.removeItem(t[a]);return a||magistraal.token.delete(),!0}},magistraal={api:{call:(a={})=>(isSet(a.callback)||(a.callback=function(){}),isSet(a.source)||(a.source="both"),isSet(a.scope)||(a.scope=void 0),!!isSet(a.url)&&(isSet(a.data)||(a.data={}),isSet(a.cachable)||(a.cachable="server_only"!=a.source),isSet(a.xhrFields)||(a.xhrFields={}),isSet(a.alwaysReturn)||(a.alwaysReturn={}),new Promise(((t,e)=>{if(a.cachable){const e=magistraalPersistentStorage.get(`api_response.${a.url}.${JSON.stringify(a.data)}`).value;if(isSet(e))if("prefer_cache"==a.source)try{return t(e),void("function"==typeof a.callback&&a.callback(e,"cache_final",void 0,a.url))}catch(a){magistraal.console.error()}else try{t(e),"function"==typeof a.callback&&a.callback(e,"cache_pre",void 0,a.url)}catch(a){magistraal.console.error()}}a.xhrFields.withCredentials=!0,$.ajax({method:"POST",url:`${magistraalStorage.get("api").value}${a.url}/`,data:a.data,headers:{Accept:"*/*"},xhrFields:a.xhrFields,cache:!1,success:function(e,s,i){if(!isSet(a.scope)||a.scope==magistraal.page.current(!0))if(isSet(e.success)&&!0===e.success&&isSet(e.data)){a.cachable&&magistraalPersistentStorage.set(`api_response.${a.url}.${JSON.stringify(a.data)}`,e);try{t(e),"function"==typeof a.callback&&a.callback(e,"server_final",i,a.url)}catch(a){magistraal.console.error()}}else try{a.alwaysReturn&&(t(e),"function"==typeof a.callback&&a.callback(e,"server_final",i,a.url))}catch(a){magistraal.console.error()}},error:function(s){if(isSet(s.responseJSON)&&isSet(s.responseJSON.info)&&"token_invalid"==s.responseJSON.info)return magistraal.token.delete(),void magistraal.page.load({page:"login"});if(!isSet(a.scope)||a.scope==magistraal.page.current())if(0==s.readyState&&0==s.status){const e=magistraalPersistentStorage.get(`api_response.${a.url}.${JSON.stringify(a.data)}`).value;if(isSet(e)){try{t(e),"function"==typeof a.callback&&a.callback(e,"cache_final",void 0,a.url)}catch(a){magistraal.console.error()}return}}else isSet(s.responseJSON)&&isSet(s.responseJSON.info)||a.alwaysReturn?(e(s),"function"==typeof a.callback&&a.callback(s,"cache_final",void 0,a.url)):magistraal.console.error()}})}))))},absences:{paintList:a=>{let t=$("<div></div>");$.each(a.data,(function(a,e){if(0==e.absences.length)return!0;let s=magistraal.template.get("absences-group");s.find(".absences-group-title").text(capitalizeFirst(magistraal.locale.formatDate(e.time,"Fy"))),$.each(e.absences,(function(a,t){let e=magistraal.template.get("absence-list-item");e.find(".list-item-title").html(t.appointment.designation+'<span class="bullet"></span>'+magistraal.locale.formatDate(t.appointment.start.time,"Hi")+" - "+magistraal.locale.formatDate(t.appointment.end.time,"Hi")),e.find(".list-item-icon").text(t.lesson||t.abbr),e.find(".list-item-content").text(t.designation),e.attr({"data-interesting":!0,"data-permitted":t.permitted,"data-search":t.designation,"data-type":t.type}),magistraal.sidebar.addFeed(e,{title:t.appointment.designation,subtitle:t.designation,table:{"absence.date":capitalizeFirst(magistraal.locale.formatDate(t.appointment.start.time,"ldFY")),"absence.time":magistraal.locale.formatDate(t.appointment.start.time,"Hi")+" - "+magistraal.locale.formatDate(t.appointment.end.time,"Hi"),"absence.lesson":t.lesson,"absence.permitted":magistraal.locale.formatBoolean(t.permitted)}}),e.appendTo(s)})),s.appendTo(t)})),magistraal.page.setContent(t)}},appointments:{paintList:a=>{let t=$("<div></div>");$.each(a.data,(function(a,e){let s=magistraal.template.get("appointments-group");if(s.find(".appointments-group-title").text(capitalizeFirst(magistraal.locale.formatDate(e.time,"ldF"))),0==e.appointments.length)return!0;$.each(e.appointments,(function(a,t){let e=magistraal.template.get("appointment");t.editable="personal"==t.type||"planning"==t.type,e.attr({"data-editable":t.editable,"data-finishable":!0,"data-finished":t.finished,"data-has-attachments":t.has_attachments,"data-has-meeting-link":t.has_meeting_link,"data-id":t.id,"data-info-type":t.info_type,"data-interesting":"canceled"!=t.status,"data-search":`${t.subjects.join(", ")} ${t.designation} ${t.content_text}`.trim(),"data-status":t.status,"data-type":t.type}),t.start.lesson>0?e.find(".list-item-icon").text(t.duration.lessons<=1?t.start.lesson:`${t.start.lesson}-${t.end.lesson}`):e.find(".list-item-icon").html("schedule"==t.status?'<i class="fal fa-info"></i>':""),t.has_meeting_link&&e.find(".lesson-join-ms-teams").attr("href",t.meeting_link),e.find(".appointment-time").text(magistraal.locale.formatDate(t.start.time,"Hi")+" - "+magistraal.locale.formatDate(t.end.time,"Hi")),e.find(".appointment-designation").text(""==t.facility?t.designation:`${t.designation} (${t.facility})`),e.find(".list-item-content").html(t.content_text);let i=magistraal.locale.translate(`appointments.appointment.info_type.${t.info_type}`);e.find(".list-item-action-primary").text(i);let l={title:t.designation,subtitle:`${magistraal.locale.formatDate(t.start.time,"Hi")} - ${magistraal.locale.formatDate(t.end.time,"Hi")}`,table:{"appointment.facility":t.facility,"appointment.start":capitalizeFirst(magistraal.locale.formatDate(t.start.time,"ldFYHi")),"appointment.end":capitalizeFirst(magistraal.locale.formatDate(t.end.time,"ldFYHi")),"appointment.school_subject":t.subjects.join(", ")},actions:{}};l.table[`appointment.info_type.${t.info_type}`]=t.content,l.table["appointment.teachers"]=t.teachers.join(", "),t.editable&&(l.actions={edit:{handler:`magistraal.appointments.edit({id: '${t.id}', start: '${t.start.time}', end: '${t.end.time}', facility: '${escapeQuotes(t.facility)}', designation: '${escapeQuotes(t.designation)}', content: '${escapeQuotes(t.content)}'})`,icon:"fal fa-pencil-alt"},delete:{handler:`magistraal.appointments.delete('${t.id}')`,icon:"fal fa-trash"}}),magistraal.sidebar.addFeed(e,l),e.appendTo(s)})),s.appendTo(t)})),magistraal.page.setContent(t)},view:a=>{if("true"!=$(`.appointment-list-item[data-id="${a}"]`).attr("data-has-attachments"))return!1;magistraal.console.loading("console.loading.appointment_attachments"),magistraal.api.call({url:"appointments/info",data:{id:a},callback:magistraal.appointments.viewCallback})},viewCallback:(a,t)=>{let e="";a.attachments.length>0&&$.each(a.attachments,(function(a,t){t.icon=magistraal.mapping.icons("file_icons",t.mime_type),e+=`<div class="anchor" onclick="magistraal.files.download('${t.location}');"><i class="${t.icon} icon-inline"></i>${t.name}.${t.type}</div>`})),magistraal.sidebar.updateFeed({table:{"appointment.attachments":e}},"appointment.end"),"server_final"==t&&magistraal.console.success("console.success.appointment_attachments")},finish:(a,t)=>{if("true"!=$(`.appointment-list-item[data-id="${a}"]`).attr("data-finishable"))return!1;$(`.appointment-list-item[data-id="${a}"]`).attr("data-finished",t),magistraal.console.loading("console.loading.finish_appointment"),magistraal.api.call({url:"appointments/finish",data:{id:a,finished:t},source:"both"}).then((()=>{magistraal.console.success("console.success.finish_appointment")})).catch((()=>{$(`.appointment-list-item[data-id="${a}"]`).attr("data-finished",!t)}))},create:(a,t)=>{magistraal.console.loading("console.loading.create_appointment");let e=new Date(a.date);e.setHours(a.start.hours,a.start.minutes,0),a.start=e.toISOString();let s=new Date(a.date);s.setHours(a.end.hours,a.end.minutes,1),a.end=s.toISOString(),magistraal.api.call({url:"appointments/create",data:a,source:"server_only"}).then((a=>{magistraal.console.success("console.success.create_appointment"),magistraal.page.load({page:"appointments/list"}),t&&t.formReset()})).catch((a=>{if(magistraal.popup.open("appointments_create_appointment"),a.responseJSON&&a.responseJSON.info)return magistraal.console.error(`console.error.${a.responseJSON.info}`),!1}))},edit:a=>{let t=magistraal.element.get("form-appointments_create_appointment");t.find('[name="id"]').value(a.id),t.find('[name="date"]').value(a.start),t.find('[name="start"]').value(a.start),t.find('[name="end"]').value(a.end),t.find('[name="facility"]').value(a.facility),t.find('[name="designation"]').value(a.designation),t.find('[name="content"]').value(a.content),magistraal.popup.open("appointments_create_appointment")},delete:a=>{magistraal.console.loading("console.loading.delete_appointment"),magistraal.api.call({url:"appointments/delete",data:{id:a},source:"server_only"}).then((a=>{magistraal.console.success("console.success.delete_appointment"),magistraal.page.load({page:"appointments/list"})})).catch((a=>{if(a.responseJSON&&a.responseJSON.info)return magistraal.console.error(`console.error.${a.responseJSON.info}`),!1}))}},files:{download:a=>{magistraal.console.loading("console.loading.download"),magistraal.api.call({url:"files/download",data:{location:a},source:"server_only",callback:magistraal.files.downloadCallback,xhrFields:{responseType:"arraybuffer"},alwaysReturn:!0})},downloadCallback(a,t,e,s){let i=new Blob([a],{type:e.getResponseHeader("Content-Type")}),l=document.createElement("a");l.href=URL.createObjectURL(i),l.download=decodeURI((e.getResponseHeader("Content-Disposition")??"filename=Bestand").split("filename=")[1]),l.click(),l.remove(),magistraal.console.success("console.success.download")}},grades:{paintList:a=>{let t=$("<div></div>");$.each(a.data,(function(a,e){let s=magistraal.template.get("grade-list-item"),i=magistraal.locale.formatDate(e.entered_at,"dFYHi");s.attr({"data-counts":e.counts,"data-exemption":e.exemption,"data-interesting":!0,"data-passed":e.passed,"data-search":`${e.value_str} ${e.subject.description} ${e.description} ${i}`,"data-value":e.value,"data-weight":e.weight}),s.find(".list-item-icon").text(e.value_str),s.find(".grade-subject").text(e.subject.description),s.find(".grade-description").text(e.description),s.find(".grade-weight").text(`${e.weight}x`),s.find(".grade-entered-at").text(i);let l={title:e.subject.description,subtitle:capitalizeFirst(e.description),table:{"grade.value":e.value_str,"grade.weight":`${e.weight}x`,"grade.entered_at":capitalizeFirst(i),"grade.counts":magistraal.locale.formatBoolean(e.counts),"grade.exemption":magistraal.locale.formatBoolean(e.exemption)}};magistraal.sidebar.addFeed(s,l),s.appendTo(t)})),magistraal.page.setContent(t)}},messages:{paintList:a=>{magistraal.api.call({url:"messages/info",data:{id:String(a.data[0].id)},source:"prefer_cache"}),magistraal.api.call({url:"messages/info",data:{id:String(a.data[1].id)},source:"prefer_cache"}),magistraal.api.call({url:"messages/info",data:{id:String(a.data[2].id)},source:"prefer_cache"});let t=$("<div></div>");$.each(a.data,(function(a,e){let s=magistraal.template.get("message-list-item");e.subject=e.subject||magistraal.locale.translate("messages.subject.no_subject"),s.find(".message-list-item-title").text(e.subject),s.find(".message-list-item-side-title").text(),s.find(".message-list-item-content").text(e.sender.name),s.attr({"data-id":e.id,"data-interesting":!0,"data-priority":e.priority,"data-read":e.read,"data-search":e.subject+e.sender.name});const i=e.read?"envelope-open":"envelope";s.find(".message-list-item-icon").html(`<i class="fal fa-${i}"></i>`),magistraal.sidebar.addFeed(s,{title:e.subject,subtitle:e.sender.name,table:{"message.sender":e.sender.name,"message.sent_at":capitalizeFirst(magistraal.locale.formatDate(e.sent_at,"ldFYHi"))}}),s.appendTo(t)})),magistraal.page.setContent(t)},view:(a,t=!0)=>{magistraal.console.loading("console.loading.message_content"),magistraal.api.call({url:"messages/info",data:{id:a},callback:magistraal.messages.viewCallback,source:"prefer_cache"}),t||magistraal.api.call({url:"messages/info",data:{id:a,read:!0}})},viewCallback:(a,t)=>{let e="";const s=a.data;s.attachments.length>0&&$.each(s.attachments,(function(a,t){t.icon=magistraal.mapping.icons("file_icons",t.mime_type),e+=`<div class="anchor" onclick="magistraal.files.download('${t.location}');"><i class="${t.icon} mr-1"></i>${t.name}.${t.type}</div>`}));let i={table:{"message.to":s.recipients.to.names.join(", "),"message.cc":s.recipients.cc.names.join(", "),"message.bcc":s.recipients.bcc.names.join(", "),"message.attachments":e,"message.content":s.content}};magistraal.sidebar.updateFeed(i,void 0),"server_final"==t&&magistraal.console.success("console.success.message_content")},send:(a,t)=>{magistraal.console.loading("console.loading.send_message"),magistraal.api.call({url:"messages/send",data:a,source:"server_only"}).then((a=>{magistraal.console.success("console.success.send_message"),magistraal.page.load({page:"messages/list"}),t&&t.formReset()})).catch((a=>{magistraal.popup.open("messages_write_message"),magistraal.console.error(`console.error.${a.responseJSON?.info}`)}))}},settings:{paintList:a=>{let t=magistraalPersistentStorage.get("settings").value||[],e=$("<div></div>");$.each(a.data.items,(function(s,i){let l=$("<div></div>");if(isSet(i.items)){l=magistraal.template.get("setting-category"),l.find(".setting-category-title").text(magistraal.locale.translate(`settings.category.${a.data.category}.${s}.title`)),l.find(".setting-category-icon").html(`<i class="${i?.icon||"cog"}"></i>`);let t=$("<div></div>");$.each(i.items,(function(a,e){isSet(e.items)?t.append(`<span>${magistraal.locale.translate(`settings.category.${s}.${a}.title`)}</span><span class="bullet"></span>`):t.append(`<span>${magistraal.locale.translate(`settings.setting.${s}.${a}.title`)}</span><span class="bullet"></span>`)})),t.find(".bullet:last-child").remove(),l.find(".setting-category-content").html(t.html()),l.attr("onclick",`magistraal.page.load({page: 'settings/list', data: {'category': '${s}'}, showBack: true});`)}else{l=magistraal.template.get("setting-list-item");let e=$('<input class="form-control input-search">'),n=`${a.data.category}.${s}`;switch(e.appendTo(l.find(".list-item-content")),isSet(t[n])&&(i.value=t[n]),n){case"appearance.theme":!isSet(i.value)||"dark_auto"!=i.value&&"light_auto"!=i.value||(i.value="auto");break;case"system.version":i.value=magistraalPersistentStorage.get("version").value||"-";break;case"system.user_uuid":i.value=magistraalPersistentStorage.get("user_uuid").value||"-";break;case"system.user_agent":i.value=navigator.userAgent||"-";break}let r=new magistraal.inputs.searchInput(e);const o=i?.value||i?.default||null,c=magistraal.locale.translate(`settings.setting.${n}.value.${o}.title`,magistraal.locale.translate("generic.invalid"));let g=[];isSet(i.enabled)&&"true"!=i.enabled?(l.removeClass("list-item-with-input"),l.find(".list-item-content").text(o)):($.each(i.values,(function(a,t){const e=magistraal.locale.translate(`settings.setting.${n}.value.${t?.title}.title`);g.push({title:e,value:a,icon:t?.icon,description:t?.description||e})})),r.results.set(g),e.value(o),e.val(c),r.results.select(o)),l.attr({"data-setting":`${a.data.category}.${s}`,"data-reload":i?.options?.do_reload||!1}),l.find(".list-item-icon").html(`<i class="${i?.icon||"cog"}"></i>`),l.find(".list-item-title").text(magistraal.locale.translate(`settings.setting.${a.data.category}.${s}.title`))}l.appendTo(e)})),magistraal.page.setContent(e)},updateClient:(a,t=!1)=>{isSet(a)||(a={});let e={};Object.assign(e,a),isSet(a["appearance.theme"])&&a["appearance.theme"].includes("auto")&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e["appearance.theme"]="dark_auto":e["appearance.theme"]="light_auto"),magistraalPersistentStorage.set("settings",a),Object.entries(a).toString()!=Object.entries(e).toString()&&t&&magistraal.settings.set_all(e);let s="";$.each(e,(function(a,t){s+=`${a}=${t},`})),$("body").attr("data-settings",trim(s,","))},get_all:()=>new Promise(((a,t)=>{magistraal.api.call({url:"user/settings/get_all"}).then((t=>{a(t.data)})).catch((a=>{magistraal.console.error(),t(a.data)}))})),set:(a,t)=>(magistraal.console.loading("console.loading.save"),new Promise(((e,s)=>{magistraal.api.call({url:"user/settings/set",data:{setting:a,value:t},source:"server_only"}).then((a=>{magistraal.settings.updateClient(a.data),magistraal.console.success("console.success.save"),e()})).catch((a=>{magistraal.console.error(),s()}))}))),set_all:a=>(magistraal.console.loading("console.loading.save"),new Promise(((t,e)=>{magistraal.api.call({url:"user/settings/set_all",data:{settings:a},source:"server_only"}).then((a=>{magistraal.settings.updateClient(a.data),magistraal.console.success("console.success.save"),t()})).catch((a=>{magistraal.console.error(),e()}))})))},console:{info:a=>magistraal.console.send(a,"info",2500),error:(a="console.error.generic")=>magistraal.console.send(a,"error",-1),success:(a="console.success.generic")=>magistraal.console.send(a,"success",1500),loading:(a="console.loading.generic")=>magistraal.console.send(a,"loading",-1),clear:()=>{$(".console-message").remove()},send:(a,t="success",e=1500)=>{a=magistraal.locale.translate(a,magistraal.locale.translate(`console.${t}.generic`,a));let s=Date.now(),i={info:{icon:"info-circle",color:"var(--secondary)"},loading:{icon:"circle-notch fa-spin",color:"var(--secondary)"},debug:{icon:"info-circle",color:"var(--secondary)"},error:{icon:"exclamation-circle",color:"var(--danger)"},success:{icon:"check-circle",color:"var(--success)"}},l=i[t]||i.info;return $(".console-message").remove(),magistraal.element.get("console").prepend(`\n\t\t\t\t\t\t\t\t<div class="console-message" data-magistraal="console-message-${s}">\n\t\t\t\t\t\t\t\t\t\t<span class="console-message-content">${a}</span>\n\t\t\t\t\t\t\t\t\t\t<span class="console-message-icon pl-1"><i class="fal fa-${l.icon}" style="color: ${l.color};"></i></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`),e>=0&&setTimeout((()=>{magistraal.element.get(`console-message-${s}`).remove()}),e),s}},load:(a={})=>{try{if(magistraalStorage.set("api","/magistraal/api/"),!isSet(a.version))return!1;magistraalPersistentStorage.get("version").value!=a?.version&&magistraalPersistentStorage.clear(!0);const t=magistraalPersistentStorage.get("settings").value,e=isSet(t)&&isSet(t["appearance.language"])?t["appearance.language"]:"nl_NL";return magistraalStorage.set("version",a?.version),magistraalPersistentStorage.set("version",a?.version),new Promise(((t,s)=>{magistraal.locale.load(e).then((()=>{$(document).trigger("magistraal.ready"),t()})).catch((()=>{})),a?.doPreCache}))}catch(a){}},locale:{load:a=>new Promise(((t,e)=>{magistraal.api.call({url:"locale",data:{locale:a},source:"both",callback:magistraal.locale.loadCallback}).finally((()=>{t()})).catch((()=>{}))})),loadCallback:(a,t)=>{magistraalStorage.set("translations",a),$("[data-translation]").each((function(){"input"===this.tagName.toLowerCase()||"textarea"===this.tagName.toLowerCase()?$(this).attr("placeholder",magistraal.locale.translate($(this).attr("data-translation"))):$(this).text(magistraal.locale.translate($(this).attr("data-translation")))}))},translate:(a,t)=>{t=t||a;let e=magistraalStorage.get("translations").value.data;return isSet(e)&&isSet(e[a])?e[a]:t},formatBoolean:a=>"1"==a||"yes"==a||"true"==a?magistraal.locale.translate("generic.bool.true","true"):"0"==a||"no"==a||"false"==a?magistraal.locale.translate("generic.bool.false","false"):"",formatDate:(a,t)=>{if("number"==typeof a?a=new Date(1e3*a):"string"==typeof a&&(a=new Date(a)),"object"!=typeof a)return!1;let e="";switch(t){case"Hi":e+=addLeadingZero(a.getHours())+":",e+=addLeadingZero(a.getMinutes());break;case"dF":e+=a.getDate()+" ",e+=magistraal.locale.translate(`generic.month.${a.getMonth()}`);break;case"ldF":e+=magistraal.locale.translate(`generic.day.${a.getDay()}`)+" ",e+=a.getDate()+" ",e+=magistraal.locale.translate(`generic.month.${a.getMonth()}`);break;case"Fy":e+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",e+=a.getFullYear();break;case"dFY":e+=a.getDate()+" ",e+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",e+=a.getFullYear();break;case"dmY":e+=addLeadingZero(a.getDate())+"-",e+=addLeadingZero(a.getMonth()+1)+"-",e+=a.getFullYear();break;case"ldFY":e+=magistraal.locale.translate(`generic.day.${a.getDay()}`)+" ",e+=a.getDate()+" ",e+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",e+=a.getFullYear();break;case"dmYHi":e+=addLeadingZero(a.getDate())+"-",e+=addLeadingZero(a.getMonth()+1)+"-",e+=a.getFullYear()+" ",e+=magistraal.locale.translate("generic.date_time_seperator")+" ",e+=addLeadingZero(a.getHours())+":",e+=addLeadingZero(a.getMinutes());break;case"dFYHi":e+=a.getDate()+" ",e+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",e+=a.getFullYear()+" ",e+=magistraal.locale.translate("generic.date_time_seperator")+" ",e+=addLeadingZero(a.getHours())+":",e+=addLeadingZero(a.getMinutes());break;case"ldFYHi":default:e+=magistraal.locale.translate(`generic.day.${a.getDay()}`)+" ",e+=a.getDate()+" ",e+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",e+=a.getFullYear()+" ",e+=magistraal.locale.translate("generic.date_time_seperator")+" ",e+=addLeadingZero(a.getHours())+":",e+=addLeadingZero(a.getMinutes());break}return e}},nav:{open:()=>{$("body").attr("data-nav-active",!0),magistraalStorage.set("nav_active",!0)},close:()=>{$("body").attr("data-nav-active",!1),magistraalStorage.set("nav_active",!1)},toggle:()=>{"true"==magistraalStorage.get("nav_active").value?magistraal.nav.close():magistraal.nav.open()}},page:{load:a=>{if(isSet(a.cachable)||(a.cachable=null),isSet(a.data)||(a.data={}),!isSet(a.page))return!1;switch(isSet(a.source)||(a.source=null),isSet(a.showBack)||(a.showBack=!1),a.page.includes("?")&&([a.page,a.data]=a.page.split("?"),a.data=Object.fromEntries(new URLSearchParams(a.data))),isSet(a.data.activity)&&delete a.data.activity,a.page){case"login":return void(window.location.href="../login/");case"main":return void(window.location.href="../main");case"settings/list":a.source="prefer_cache";break}magistraal.popup.close(),a.showBack?(magistraal.page.pushState("backBtn",null,null),magistraal.page.modifyLocation(a.page,a.data,"replace")):magistraal.page.modifyLocation(a.page,a.data,"push"),magistraal.sidebar.clearFeed(),magistraal.sidebar.close(),magistraal.element.get("page-search").val(""),magistraal.element.get("page-search-no-results").removeClass("show"),magistraal.element.get("main").scrollTop(0),$(".nav-item").removeClass("active"),magistraal.element.get(`nav-item-${a.page}`).addClass("active"),magistraal.page.get(a)},get:a=>{const t={"absences/list":magistraal.absences.paintList,"appointments/list":magistraal.appointments.paintList,"grades/list":magistraal.grades.paintList,"messages/list":magistraal.messages.paintList,logout:magistraal.logout.logout,"settings/list":magistraal.settings.paintList};return new Promise(((e,s)=>{if(!isSet(t[a.page]))return s(),!1;const i=t[a.page];magistraal.console.loading("console.loading.refresh"),magistraal.api.call({url:a.page,data:a.data,source:a.source,cachable:a.cachable,scope:a.page,callback:function(a,t,e,s){i(a,t,e,s),magistraal.page.getCallback(a,t,e,s)}}).then((a=>{e(a)})).catch((()=>{}))}))},getCallback:(a,t,e,s)=>{const i=magistraal.element.get("main").find('.list-item[data-interesting="true"]').first();magistraal.sidebar.selectFeed(i,!1);const l=magistraal.template.get(`page-buttons-${s}`);magistraal.element.get("page-buttons-container").html(l.length>=1?l.html():"");const n=magistraal.element.get("page-title"),r=magistraal.locale.translate(`generic.page.${s}.title`);n.text(r),document.title=`${r} | Magistraal`,"server_final"==t?magistraal.console.success("console.success.refresh"):"cache_final"==t&&magistraal.console.clear();const o=magistraal.element.get("page-search");o.value().length>0&&o.trigger("input")},current:(a=!1,t=!0)=>{const e=trim(window.location.hash.substring(2),"/");return a?e.split("?")[0]:e},previous:()=>magistraalStorage.get("previousPage").value,setContent:a=>{$("main").empty().append(a.children())},pushState:(a,t,e)=>{window.history.pushState(a,t,e),$("body").attr("data-history","true")},back:()=>{window.history.back(),$("body").removeAttr("data-history")},modifyLocation:(a,t={},e="push")=>{$.each(t,(function(a,e){isSet(e)||delete t[a]}));const s=magistraal.page.current(!1,!1),i=new URLSearchParams(t).toString(),l=i.length>0?a.includes("?")?"&":"?":"",n=a+l+i;magistraalStorage.set("previousPage",magistraal.page.current()),s!=n&&("push"==e?window.history.pushState(n,null,"#/"+n):"replace"==e&&window.history.replaceState(n,null,"#/"+n))}},login:{login:a=>{magistraal.console.loading("console.loading.login"),magistraal.api.call({url:"login",data:a,source:"server_only"}).then((a=>{isSet(a.data.user_uuid)&&magistraalPersistentStorage.set("user_uuid",a.data.user_uuid),window.location.href="../main/"})).catch((a=>{magistraal.console.error(`console.error.${a.responseJSON.info}`)}))}},inputs:{dialog:class{constructor(a={}){return isSet(a.title)||(a.title=""),isSet(a.description)||(a.description=""),isSet(a.defaultAnswer)||(a.defaultAnswer="no"),this.parameters=a,this.open()}open(){return new Promise(((a,t)=>{if($(".dialog:not([data-magistraal-template]").length>0)return void t();this.$dialog=magistraal.template.get("dialog"),this.$dialog.find(".dialog-title").text(this.parameters.title),this.$dialog.find(".dialog-description").text(this.parameters.description),window.history.pushState("preventDialogClose",null,"?prevDia"),this.$dialog.appendTo("body"),setTimeout((()=>{this.$dialog.addClass("show")}),1),this.$dialog.find(`[data-dialog-action="${this.parameters.defaultAnswer}"]`).attr("data-selected",!0),magistraal.element.get("dialog-backdrop").addClass("show");const e=this;this.$dialog.find("[data-dialog-action]").on("click",(function(){"yes"==$(this).attr("data-dialog-action")?a():t(),e.close()}))}))}close(){if(!isSet(this.$dialog))return!1;window.history.go(-1),magistraal.element.get("dialog-backdrop").removeClass("show"),this.$dialog.removeClass("show"),setTimeout((()=>{this.$dialog.remove()}),250)}},tagsInput:class{constructor(a){this.$input=a,this.setup()}setup(){0==this.$input.closest(".input-wrapper").length&&this.$input.wrap('<div class="input-wrapper"></div>'),this.$input.data("tagsInput",this),this.$wrapper=this.$input.closest(".input-wrapper"),this.$wrapper.addClass("input-tags-wrapper"),this.$tags=$('<ul class="input-tags-list"></ul>'),this.$tags.appendTo(this.$wrapper),this.$wrapper.hasClass("input-search-wrapper")&&(this.$inputGhost=$('<input type="text" class="form-control input-search input-ghost">'),this.$inputGhost.appendTo(this.$wrapper),this.$tags.append(this.$input.removeClass("input-search").detach())),this.$wrapper.on("click",(a=>{this.eventFocus(a)})),this.$wrapper.on("focusout",(a=>{this.eventFocusOut(a)})),this.$input.on("magistraal.change",(a=>{this.eventChange(a)})),this.$input.on("keyup",(a=>{this.eventKeyup(a)}))}eventFocus(a){this.$inputGhost.addClass("focus")}eventFocusOut(a){this.$inputGhost.removeClass("focus")}eventChange(a){var t,e;null!=typeof a.addTag&&this.$input.addTag(null===(t=a.addTag)||void 0===t?void 0:t.value,null===(e=a.addTag)||void 0===e?void 0:e.text)}eventKeyup(a){if(8==a.which){let a=this.$tags.find(".input-tags-tag:last-of-type").attr("value");this.$input.removeTag(a)}}},searchInput:class{constructor(a){this.$input=a,this.setup()}setup(){0==this.$input.closest(".input-wrapper").length&&this.$input.wrap('<div class="input-wrapper"></div>'),this.$input.data("searchInput",this),this.$wrapper=this.$input.closest(".input-wrapper"),this.$wrapper.addClass("input-search-wrapper"),this.$results=$('<ul class="input-search-results"></ul>'),this.$results.appendTo(this.$wrapper),this.$input.attr("placeholder")||this.$input.attr("placeholder",magistraal.locale.translate("generic.action.search")),this.$wrapper.on("click",(a=>{0===$(a.target).closest(".input-search-results").length&&this.eventFocus(a)})),$(document).on("click",(a=>{$(a.target).closest(".input-wrapper").is(this.$wrapper)||this.eventFocusOut(a)})),isSet(this.$input.attr("data-magistraal-search-api"))?(this.$input.on("input",(a=>{this.eventInput(a)})),this.$input.attr("data-magistraal-search-target","magistraal-input-results")):this.$input.on("input",debounce((a=>{this.eventInput(a)}),250)),this.$results.on("click",".input-search-result",(a=>{this.eventResultClick(a)}))}eventFocus(a){this.$wrapper.addClass("active")}eventFocusOut(a){this.$wrapper.removeClass("active")}eventInput(a){if(isSet(this.$input.attr("data-magistraal-search-api"))){let a=this.$input.attr("data-magistraal-search-api"),t=this.$input.val()||this.$input.text();magistraal.api.call({url:`${a}/search`,data:{query:t},cachable:!1}).then((t=>{let e=magistraal.inputs.search.remap_api_response(a,t);this.results.set(e)})).catch((a=>{}))}}eventResultClick(a){let t=$(a.target).closest(".input-search-result"),e=t.attr("value"),s=t.find(".input-search-result-title").text()||t.text();if(this.$input.val(""),this.results.select(e),this.$wrapper.hasClass("input-tags-wrapper")){this.$wrapper.find(".input-tags").trigger({type:"magistraal.change",addTag:{value:e,text:s}})}else this.$input.val(s).attr("data-value",e),this.$input.trigger("magistraal.change");this.$wrapper.removeClass("active")}results={set:a=>{let t="";$.each(a,(function(a,e){isSet(e.icon)&&isSet(e.description)?t+=`<li class="input-search-result input-search-result-rich" value="${e?.value}"><i class="input-search-result-icon ${e?.icon}"></i><span class="input-search-result-title">${e?.title}</span><span class="input-search-result-description">${e?.description}</span></li>`:t+=`<li class="input-search-result" value="${e?.value}"><span class="input-search-result-title">${e?.title}</span></li>`})),this.$results.html(t)},select:a=>{this.$results.find(".input-search-result").removeAttr("data-selected"),this.$results.find(`.input-search-result[value="${a}"]`).attr("data-selected",!0)}}},search:{remap_api_response:(a,t)=>{let e=[];switch(a){case"people":$.each(t.data,(function(a,t){e.push({icon:"student"==t.type?"fal fa-book-open":"fal fa-briefcase",title:""==t.infix?`${t.first_name} ${t.last_name}`:`${t.first_name} ${t.infix} ${t.last_name}`,description:t.course||t.abbr||magistraal.locale.translate(`people.type.${t.type}`),value:t.id})}));break;case"tenants":$.each(t.data,(function(a,t){e.push({icon:"fal fa-school",title:t.name,description:t.name,value:t.id})}));break}return e}}},logout:{logout:()=>{magistraal.api.call({url:"logout",source:"server_only"}).finally((()=>{magistraalPersistentStorage.clear(),magistraal.page.load({page:"login"})}))}},sidebar:{addFeed:(a,t)=>(t.title=t?.title||"",t.subtitle=t?.subtitle||"",t.table=t?.table||{},t.actions=t?.actions||{},(a=a||magistraal.element.get("sidebar")).attr("data-sidebar-feed",encodeURI(JSON.stringify(t))),!0),clearFeed:()=>magistraal.sidebar.selectFeed(void 0),getFeed:a=>(a=a||magistraal.element.get("sidebar"),JSON.parse(decodeURI(a.attr("data-sidebar-feed")||"{}"))),selectFeed:(a,t=!0)=>{if(!isSet(a))return magistraal.sidebar.setFeed(void 0,!1);$(`[class="${a.attr("class")}"]`).removeAttr("data-selected"),a.attr("data-selected",!0),magistraal.sidebar.setFeed(magistraal.sidebar.getFeed(a),t)},setFeed:(a={title:"",subtitle:"",table:{},actions:{}},t=!0)=>{let e=magistraal.element.get("sidebar-table"),s=magistraal.element.get("sidebar-actions");magistraal.element.get("sidebar-title").text(a.title),magistraal.element.get("sidebar-subtitle").text(a.subtitle),e.empty(),s.empty(),magistraal.sidebar.addFeed(void 0,a),$.each(a.table,(function(a,t){if(""==a||""==t)return!0;let s=magistraal.template.get("sidebar-table-key");s.attr("data-key",a).text(magistraal.locale.translate(`sidebar.table.info.${a}`)),s.appendTo(e);let i=magistraal.template.get("sidebar-table-value");i.html(t),i.appendTo(e)})),$.each(a.actions,(function(a,t){let e=magistraal.template.get("sidebar-action"),i="delete"==a?"danger":"secondary";e.addClass(`btn-${i}`),e.html(`\n\t\t\t\t\t<i class="btn-icon ${t?.icon}"></i>\n\t\t\t\t\t<span class="btn-text">${magistraal.locale.translate(`generic.action.${a}`)}</span>\n\t\t\t\t`),e.attr({"data-action":a,onclick:t?.handler}),e.appendTo(s)})),t&&setTimeout((()=>{magistraal.sidebar.open()}),50)},updateFeed:(a,t)=>{let e={title:"",subtitle:"",table:{},actions:{}},s=magistraal.sidebar.getFeed(),i=Object.keys(s.table).length;e.title=a?.title||s.title,e.subtitle=a?.subtitle||s.subtitle;let l=1;$.each(s.table,(function(s,n){e.table[s]=n,s!=t&&l!=i||$.each(a.table,(function(a,t){e.table[a]=t})),l++})),e.actions=s.actions,magistraal.sidebar.setFeed(e,!1)},currentFeed(){let a=magistraal.element.get("sidebar");return JSON.parse(decodeURI(a.attr("data-sidebar-feed")||"{}"))},open:()=>{if(!0===magistraalStorage.get("sidebar_active").value)return!1;window.innerWidth<768&&magistraal.page.pushState("preventSidebarClose",null,null),$("body").attr("data-sidebar-active",!0),magistraalStorage.set("sidebar_active",!0)},close:()=>{if(!1===magistraalStorage.get("sidebar_active").value)return!1;$("body").attr("data-sidebar-active",!1),magistraalStorage.set("sidebar_active",!1)},toggle:()=>{"true"==magistraalStorage.get("sidebar_active").value?magistraal.sidebar.close():magistraal.sidebar.open()}},popup:{get:a=>$(`[data-magistraal-popup="${a}"]`).first(),open:a=>{let t=magistraal.popup.get(a);if(0===t.length)return!1;window.history.pushState("preventPopupClose",null,null),magistraal.element.get("popup-backdrop").addClass("show"),magistraal.popup.enable(a),t.addClass("show")},close:(a,t=!0,e=!1)=>{isSet(a)||(a=$("[data-magistraal-popup].show").last().attr("data-magistraal-popup"));let s=magistraal.popup.get(a);if(0===s.length)return!1;if(magistraal.element.get("popup-backdrop").removeClass("show"),magistraal.popup.disable(a),s.removeClass("show"),e){const a=s.find("form").first();a.length&&a.formReset()}t&&window.history.back()},enable:a=>{magistraal.popup.get(a).find("[data-popup-action]").removeAttr("disabled")},disable:a=>{magistraal.popup.get(a).find("[data-popup-action]").attr("disabled","disabled")}},template:{get:a=>$(`[data-magistraal-template="${a}"]`).first().clone().removeAttr("data-magistraal-template")},element:{get:a=>$(`[data-magistraal="${a}"]`)},token:{isSet:()=>""!=getCookie("magistraal-authorization"),delete:()=>(setCookie("magistraal-authorization",void 0,-1),!0)},mapping:{icons(a,t){switch(a){case"file_icons":return"application/msword"==t||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==t?"fal fa-file-word":"application/vnd.ms-powerpoint"==t||"application/vnd.openxmlformats-officedocument.presentationml.presentation"==t?"fal fa-file-powerpoint":"application/pdf"==t?"fal fa-file-pdf":t.includes("image/")?"fal fa-file-image":t.includes("video/")?"fal fa-file-video":t.includes("audio/")?"fal fa-file-audio":t.includes("text/")?"fal fa-file-alt":"application/zip"==t||"application/x-zip-compressed"==t||"application/x-7z-compressed"==t||"application/vnd.rar"==t||"application/x-bzip"==t||"application/x-bzip2"==t?"fal fa-file-archive":"fal fa-file"}return"fal fa-question"}}};