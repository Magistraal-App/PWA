var _magistraalStorage={};const magistraalStorage={get:a=>_magistraalStorage[a]||void 0,set:(a,e)=>{_magistraalStorage[a]=e}},magistraalPersistentStorage={get:a=>{let e=localStorage.getItem(`magistraal.${a}`);if(null!=e)return"JSON:"==e.substring(0,5)?JSON.parse(e.substring(5)):e},set:(a,e)=>"object"==typeof e?localStorage.setItem(`magistraal.${a}`,"JSON:"+JSON.stringify(e)):void 0===e?localStorage.removeItem(`magistraal.${a}`):localStorage.setItem(`magistraal.${a}`,e),remove:a=>magistraalPersistentStorage.set(a,void 0),clear:(a=!1)=>{let e=[];for(let t=0;t<localStorage.length;t++){let s=localStorage.key(t);"magistraal"==s.substring(0,10)&&((1!=a||"magistraal.token"!=s&&"magistraal.locale"!=s)&&"magistraal.version"!=s&&e.push(localStorage.key(t)))}for(let a=0;a<e.length;a++)localStorage.removeItem(e[a]);return!0}},magistraal={api:{call:(a={})=>(void 0===a.callback&&(a.callback=function(){}),void 0===a.source&&(a.source="both"),void 0===a.scope&&(a.scope=void 0),void 0!==a.url&&(void 0===a.data&&(a.data={}),void 0===a.cachable&&(a.cachable="server_only"!=a.source),void 0===a.xhrFields&&(a.xhrFields={}),new Promise(((e,t)=>{if(a.cachable){let t=magistraalPersistentStorage.get(`api_response.${a.url}.${JSON.stringify(a.data)}`);if(void 0!==t&&("function"==typeof a.callback&&a.callback(t,"server"),"prefer_cache"==a.source))return e(t),!0}$.ajax({method:"POST",url:`${magistraalStorage.get("api")}${a.url}/`,data:a.data,headers:{Accept:"*/*","X-Auth-Token":magistraalPersistentStorage.get("token")},xhrFields:a.xhrFields,success:function(s,i,l){if(void 0!==a.scope&&a.scope!=magistraal.page.current())return!1;1==s.success?(e(s?.data||s),a.cachable&&void 0!==s.data&&magistraalPersistentStorage.set(`api_response.${a.url}.${JSON.stringify(a.data)}`,null==s?void 0:s.data)):t(s?.data||s),"function"==typeof a.callback&&a.callback(s?.data||s,"server",l)},error:function(e){if(void 0===e.responseJSON||void 0===e.responseJSON.info||"token_invalid"!=e.responseJSON.info||(magistraalPersistentStorage.remove("token"),"logout"!=a.url)){if(magistraal.console.error(),void 0!==a.scope&&a.scope!=magistraal.page.current())return!1;t(e)}else magistraal.page.get("login")},complete:function(a,e,t){let s=a.getResponseHeader("X-Auth-Token");s&&magistraalPersistentStorage.set("token",s)}})}))))},absences:{paintList:(a,e)=>{let t="";$.each(a,(function(a,e){if(0==e.absences.length)return!0;let s=magistraal.template.get("absences-group");s.find(".absences-group-title").text(capitalizeFirst(magistraal.locale.formatDate(e.time,"Fy"))),$.each(e.absences,(function(a,e){let t=magistraal.template.get("absence-list-item");t.find(".absence-list-item-title").html(e.appointment.designation+'<span class="bullet"></span>'+magistraal.locale.formatDate(e.appointment.start.time,"Hi")+" - "+magistraal.locale.formatDate(e.appointment.end.time,"Hi")),t.find(".absence-list-item-icon").text(e.lesson||e.abbr),t.find(".absence-list-item-content").text(e.designation),t.attr({"data-type":e.type,"data-permitted":e.permitted,"data-search":e.designation}),magistraal.sidebar.addFeed(t,{title:e.appointment.designation,subtitle:e.designation,table:{"absence.date":capitalizeFirst(magistraal.locale.formatDate(e.appointment.start.time,"ldFY")),"absence.time":magistraal.locale.formatDate(e.appointment.start.time,"Hi")+" - "+magistraal.locale.formatDate(e.appointment.end.time,"Hi"),"absence.lesson":e.lesson,"absence.permitted":magistraal.locale.formatBoolean(e.permitted)}}),t.appendTo(s)})),t+=s.prop("outerHTML")})),magistraal.page.setContent(t)}},appointments:{paintList:(a,e)=>{let t="";$.each(a,(function(a,e){let s=magistraal.template.get("appointments-group");if(s.find(".appointments-group-title").text(capitalizeFirst(magistraal.locale.formatDate(e.time,"ldF"))),0==e.appointments.length){let a=magistraal.template.get("appointment");return a.find(".lesson-number").html('<i class="fal fa-check"></i>'),a.attr({"data-type":"none","data-status":"none","data-search":"","data-finishable":!1}).removeAttr("onclick"),a.find(".lesson-designation").text(magistraal.locale.translate("appointments.none_this_day")),a.find(".bullet").remove(),a.appendTo(s),!0}$.each(e.appointments,(function(a,e){let t=magistraal.template.get("appointment");e.editable="personal"==e.type||"planning"==e.type,t.attr({"data-editable":e.editable,"data-finishable":!0,"data-finished":e.finished,"data-has-attachments":e.has_attachments,"data-has-meeting-link":e.has_meeting_link,"data-id":e.id,"data-info-type":e.info_type,"data-search":`${e.subjects.join(", ")} ${e.designation} ${e.content_text}`.trim(),"data-status":e.status}),e.start.lesson>0?t.find(".lesson-number").text(e.duration.lessons<=1?e.start.lesson:`${e.start.lesson}-${e.end.lesson}`):t.find(".lesson-number").html("schedule"==e.status?'<i class="fal fa-info"></i>':""),e.has_meeting_link&&t.find(".lesson-join-ms-teams").attr("href",e.meeting_link),t.find(".lesson-time").text(magistraal.locale.formatDate(e.start.time,"Hi")+" - "+magistraal.locale.formatDate(e.end.time,"Hi")),t.find(".lesson-designation").text(""==e.facility?e.designation:`${e.designation} (${e.facility})`),t.find(".lesson-content").html(e.content_text);let i=magistraal.locale.translate(`appointments.appointment.info_type.${e.info_type}`);t.find(".lesson-type").text(i);let l={title:e.designation,subtitle:`${magistraal.locale.formatDate(e.start.time,"Hi")} - ${magistraal.locale.formatDate(e.end.time,"Hi")}`,table:{"appointment.facility":e.facility,"appointment.start":capitalizeFirst(magistraal.locale.formatDate(e.start.time,"ldFYHi")),"appointment.end":capitalizeFirst(magistraal.locale.formatDate(e.end.time,"ldFYHi")),"appointment.school_subject":e.subjects.join(", ")},actions:{}};l.table[`appointment.info_type.${e.info_type}`]=e.content,l.table["appointment.teachers"]=e.teachers.join(", "),e.editable&&(l.actions={edit:{handler:`magistraal.appointments.edit({id: '${e.id}', start: '${e.start.time}', end: '${e.end.time}', facility: '${escapeQuotes(e.facility)}', designation: '${escapeQuotes(e.designation)}', content: '${escapeQuotes(e.content)}'})`,icon:"fal fa-pencil"},delete:{handler:`magistraal.appointments.delete('${e.id}')`,icon:"fal fa-trash"}}),magistraal.sidebar.addFeed(t,l),t.appendTo(s)})),t+=s.prop("outerHTML")})),magistraal.page.setContent(t)},view:a=>{if("true"!=$(`.appointment[data-id="${a}"]`).attr("data-has-attachments"))return!1;magistraal.console.loading("console.loading.appointment_attachments"),magistraal.api.call({url:"appointments/info",data:{id:a},callback:magistraal.appointments.viewCallback})},viewCallback:(a,e)=>{let t="";a.attachments.length>0&&$.each(a.attachments,(function(a,e){e.icon=magistraal.mapping.icons("file_icons",e.mime_type),t+=`<div class="anchor" onclick="magistraal.files.download('${e.location}');"><i class="${e.icon} icon-inline"></i>${e.name}.${e.type}</div>`})),magistraal.sidebar.updateFeed({table:{"appointment.attachments":t}},"appointment.end"),"server"==e&&magistraal.console.success("console.success.appointment_attachments")},finish:(a,e)=>{if("true"!=$(`.appointment[data-id="${a}"]`).attr("data-finishable"))return!1;$(`.appointment[data-id="${a}"]`).attr("data-finished",e),magistraal.console.loading("console.loading.finish_appointment"),magistraal.api.call({url:"appointments/finish",data:{id:a,finished:e},source:"both"}).then((()=>{magistraal.console.success("console.success.finish_appointment")})).catch((()=>{$(`.appointment[data-id="${a}"]`).attr("data-finished",!e)}))},create:(a,e=null)=>{magistraal.console.loading("console.loading.create_appointment");let t=new Date(a.date);t.setHours(a.start.hours,a.start.minutes),a.start=t.toISOString();let s=new Date(a.date);s.setHours(a.end.hours,a.end.minutes),a.end=s.toISOString(),magistraal.api.call({url:"appointments/create",data:a,source:"server_only"}).then((a=>{magistraal.console.success("console.success.create_appointment"),magistraal.page.load("appointments/list"),e&&e.formReset()})).catch((a=>{if(magistraal.popup.open("appointments-create-appointment"),a.responseJSON&&a.responseJSON.info)return magistraal.console.error(magistraal.locale.translate(`console.error.${a.responseJSON.info}`,"console.error.generic")),!1}))},edit:a=>{let e=magistraal.element.get("form-appointments-create-appointment");e.find('[name="id"]').value(a.id),e.find('[name="date"]').value(a.start),e.find('[name="start"]').value(a.start),e.find('[name="end"]').value(a.end),e.find('[name="facility"]').value(a.facility),e.find('[name="designation"]').value(a.designation),e.find('[name="content"]').value(a.content),magistraal.popup.open("appointments-create-appointment")},delete:a=>{magistraal.console.loading("console.loading.delete_appointment"),magistraal.api.call({url:"appointments/delete",data:{id:a},source:"server_only"}).then((a=>{magistraal.console.success("console.success.delete_appointment"),magistraal.page.load("appointments/list")})).catch((a=>{if(a.responseJSON&&a.responseJSON.info)return magistraal.console.error(magistraal.locale.translate(`console.error.${a.responseJSON.info}`,"console.error.generic")),!1}))}},files:{download:a=>{magistraal.console.loading("console.loading.download"),magistraal.api.call({url:"files/download",data:{location:a},source:"server_only",callback:magistraal.files.downloadCallback,xhrFields:{responseType:"arraybuffer"}})},downloadCallback(a,e,t){let s=new Blob([a],{type:t.getResponseHeader("Content-Type")}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=decodeURI((t.getResponseHeader("Content-Disposition")??"filename=Bestand").split("filename=")[1]),i.click(),i.remove(),magistraal.console.success("console.success.download")}},grades:{paintList:(a,e,t)=>{let s="";$.each(a,(function(a,e){let t=magistraal.template.get("grade-list-item"),i=magistraal.locale.formatDate(e.entered_at,"dFYHi");t.attr({"data-counts":e.counts,"data-exemption":e.exemption,"data-passed":e.passed,"data-search":`${e.value_str} ${e.subject.description} ${e.description} ${i}`,"data-value":e.value,"data-weight":e.weight}),t.find(".list-item-icon").text(e.value_str),t.find(".grade-subject").text(e.subject.description),t.find(".grade-description").text(e.description),t.find(".grade-weight").text(`${e.weight}x`),t.find(".grade-entered-at").text(i);let l={title:e.subject.description,subtitle:capitalizeFirst(e.description),table:{"grade.value":e.value_str,"grade.weight":`${e.weight}x`,"grade.entered_at":capitalizeFirst(i),"grade.counts":magistraal.locale.formatBoolean(e.counts),"grade.exemption":magistraal.locale.formatBoolean(e.exemption)}};magistraal.sidebar.addFeed(t,l),s+=t.prop("outerHTML")})),magistraal.page.setContent(s)}},messages:{paintList:(a,e)=>{magistraal.api.call({url:"messages/info",data:{id:String(a[0].id)},source:"prefer_cache"}),magistraal.api.call({url:"messages/info",data:{id:String(a[1].id)},source:"prefer_cache"}),magistraal.api.call({url:"messages/info",data:{id:String(a[2].id)},source:"prefer_cache"});let t="";$.each(a,(function(a,e){let s=magistraal.template.get("message-list-item");e.subject=e.subject||magistraal.locale.translate("messages.subject.no_subject"),s.find(".message-list-item-title").text(e.subject),s.find(".message-list-item-side-title").text(),s.find(".message-list-item-content").text(e.sender.name),s.attr({"data-id":e.id,"data-priority":e.priority,"data-read":e.read,"data-search":e.subject+e.sender.name});let i=1==e.read?"envelope-open":"envelope";s.find(".message-list-item-icon").html(`<i class="fal fa-${i}"></i>`),magistraal.sidebar.addFeed(s,{title:e.subject,subtitle:e.sender.name,table:{"message.sender":e.sender.name,"message.sent_at":capitalizeFirst(magistraal.locale.formatDate(e.sent_at,"ldFYHi"))}}),t+=s.prop("outerHTML")})),magistraal.page.setContent(t)},view:(a,e=!0)=>{magistraal.console.loading("console.loading.message_content"),magistraal.api.call({url:"messages/info",data:{id:a},callback:magistraal.messages.viewCallback,source:"prefer_cache"}),1!=e&&magistraal.api.call({url:"messages/info",data:{id:a,read:!0}})},viewCallback:(a,e)=>{let t="";a.attachments.length>0&&$.each(a.attachments,(function(a,e){e.icon=magistraal.mapping.icons("file_icons",e.mime_type),t+=`<div class="anchor" onclick="magistraal.files.download('${e.location}');"><i class="${e.icon} mr-1"></i>${e.name}.${e.type}</div>`}));let s={table:{"message.to":a.recipients.to.names.join(", "),"message.cc":a.recipients.cc.names.join(", "),"message.bcc":a.recipients.bcc.names.join(", "),"message.attachments":t,"message.content":a.content}};magistraal.sidebar.updateFeed(s,void 0),"server"==e&&magistraal.console.success("console.success.message_content")},send:(a,e=null)=>{magistraal.console.loading("console.loading.send_message"),magistraal.api.call({url:"messages/send",data:a,source:"server_only"}).then((a=>{magistraal.console.success("console.success.send_message"),magistraal.page.load("messages/list"),e&&e.formReset()})).catch((a=>{if(magistraal.popup.open("messages-write-message"),void 0!==a.responseJSON.info)return magistraal.console.error(magistraal.locale.translate(`console.error.${a.responseJSON.info}`,"console.error.generic")),!1;magistraal.console.error("console.error.generic")}))}},settings:{paintList:a=>{let e="";$.each(a.items,(function(t,s){if(void 0!==s.items){let i=magistraal.template.get("setting-category");i.find(".setting-category-title").text(magistraal.locale.translate(`settings.category.${a.category}.${t}.title`)),i.find(".setting-category-icon").html(`<i class="${(null==s?void 0:s.icon)||"cog"}"></i>`);let l="";$.each(s.items,(function(a,e){void 0===e.items?l+=magistraal.locale.translate(`settings.setting.${t}.${a}.title`)+", ":l+=magistraal.locale.translate(`settings.category.${t}.${a}.title`)+", "})),l=l.slice(0,-2),i.find(".setting-category-content").text(l),i.attr("onclick",`magistraal.page.load('settings/list', {'category': '${t}'});`),e+=i.prop("outerHTML")}})),magistraal.page.setContent(e)}},console:{info:a=>magistraal.console.send(a,"info",2500),error:(a="console.error.generic")=>magistraal.console.send(a,"error",-1),success:(a="console.success.generic")=>magistraal.console.send(a,"success",1500),loading:(a="console.loading.generic")=>magistraal.console.send(a,"loading",-1),send:(a,e="success",t=1500)=>{a=magistraal.locale.translate(a,a);let s=Date.now(),i={info:{icon:"info-circle",color:"var(--secondary)"},loading:{icon:"circle-notch fa-spin",color:"var(--secondary)"},debug:{icon:"info-circle",color:"var(--secondary)"},error:{icon:"exclamation-circle",color:"var(--danger)"},success:{icon:"check-circle",color:"var(--success)"}},l=i[e]||i.info;return $(".console-message").remove(),magistraal.element.get("console").prepend(`\n\t\t\t\t\t\t\t\t<div class="console-message" data-magistraal="console-message-${s}">\n\t\t\t\t\t\t\t\t\t\t<span class="console-message-content">${a}</span>\n\t\t\t\t\t\t\t\t\t\t<span class="console-message-icon pl-1"><i class="fal fa-${l.icon}" style="color: ${l.color};"></i></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`),t>=0&&setTimeout((()=>{magistraal.element.get(`console-message-${s}`).remove()}),t),s}},load:(a="")=>(magistraalStorage.set("api","/magistraal/api/"),magistraalPersistentStorage.get("version")!=a&&magistraalPersistentStorage.clear(!0),magistraalStorage.set("version",a),magistraalPersistentStorage.set("version",a),new Promise(((a,e)=>{magistraal.locale.load("nl_NL").then((()=>{$(document).trigger("magistraal.ready"),a()})).catch((()=>{})),0!=typeof magistraalPersistentStorage.get("token")&&(magistraal.api.call({url:"absences/list",source:"prefer_cache"}),magistraal.api.call({url:"appointments/list",source:"prefer_cache"}),magistraal.api.call({url:"grades/list",source:"prefer_cache"}),magistraal.api.call({url:"messages/list",source:"prefer_cache"}),magistraal.api.call({url:"settings/list",source:"prefer_cache"}))}))),locale:{load:a=>new Promise(((e,t)=>{magistraal.api.call({url:"locale",data:{locale:a},source:"both",callback:magistraal.locale.loadCallback}).finally((()=>{e()})).catch((()=>{}))})),loadCallback:(a,e)=>{magistraalStorage.set("translations",a),$("[data-translation]").each((function(){"input"===this.tagName.toLowerCase()||"textarea"===this.tagName.toLowerCase()?$(this).attr("placeholder",magistraal.locale.translate($(this).attr("data-translation"))):$(this).text(magistraal.locale.translate($(this).attr("data-translation")))}))},translate:(a,e)=>{e=e||a;let t=magistraalStorage.get("translations");return void 0===t||void 0===t[a]?e:t[a]},formatBoolean:a=>"1"==a||"yes"==a||"true"==a?magistraal.locale.translate("generic.bool.true","true"):"0"==a||"no"==a||"false"==a?magistraal.locale.translate("generic.bool.false","false"):"",formatDate:(a,e)=>{if("number"==typeof a?a=new Date(1e3*a):"string"==typeof a&&(a=new Date(a)),"object"!=typeof a)return!1;let t="";switch(e){case"Hi":t+=addLeadingZero(a.getHours())+":",t+=addLeadingZero(a.getMinutes());break;case"dF":t+=a.getDate()+" ",t+=magistraal.locale.translate(`generic.month.${a.getMonth()}`);break;case"ldF":t+=magistraal.locale.translate(`generic.day.${a.getDay()}`)+" ",t+=a.getDate()+" ",t+=magistraal.locale.translate(`generic.month.${a.getMonth()}`);break;case"Fy":t+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",t+=a.getFullYear();break;case"dFY":t+=a.getDate()+" ",t+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",t+=a.getFullYear();break;case"dmY":t+=addLeadingZero(a.getDate())+"-",t+=addLeadingZero(a.getMonth()+1)+"-",t+=a.getFullYear();break;case"ldFY":t+=magistraal.locale.translate(`generic.day.${a.getDay()}`)+" ",t+=a.getDate()+" ",t+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",t+=a.getFullYear();break;case"dmYHi":t+=addLeadingZero(a.getDate())+"-",t+=addLeadingZero(a.getMonth()+1)+"-",t+=a.getFullYear()+" ",t+=magistraal.locale.translate("generic.date_time_seperator")+" ",t+=addLeadingZero(a.getHours())+":",t+=addLeadingZero(a.getMinutes());break;case"dFYHi":t+=a.getDate()+" ",t+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",t+=a.getFullYear()+" ",t+=magistraal.locale.translate("generic.date_time_seperator")+" ",t+=addLeadingZero(a.getHours())+":",t+=addLeadingZero(a.getMinutes());break;case"ldFYHi":default:t+=magistraal.locale.translate(`generic.day.${a.getDay()}`)+" ",t+=a.getDate()+" ",t+=magistraal.locale.translate(`generic.month.${a.getMonth()}`)+" ",t+=a.getFullYear()+" ",t+=magistraal.locale.translate("generic.date_time_seperator")+" ",t+=addLeadingZero(a.getHours())+":",t+=addLeadingZero(a.getMinutes());break}return t}},nav:{open:()=>{$("body").attr("data-nav-active",!0),magistraalStorage.set("nav_active",!0)},close:()=>{$("body").attr("data-nav-active",!1),magistraalStorage.set("nav_active",!1)},toggle:()=>{"true"==magistraalStorage.get("nav_active")?magistraal.nav.close():magistraal.nav.open()}},page:{load:(a,e={},t=!0)=>{if("login"==(a=trim(a.replace(/[^a-zA-Z\/]/g,""),"/"))||"main"==a)return window.location.href=`../${a}/`,!0;"logout"==a&&magistraal.logout.logout(),history.pushState(null,null,window.location.pathname+"#"+a+"/"+random(1e3,9999)),magistraal.sidebar.clearFeed(),magistraal.sidebar.close(),magistraal.element.get("main").scrollTop(0),$(".nav-item").removeClass("active"),magistraal.element.get(`nav-item-${a}`).addClass("active"),magistraal.page.get(a,e,t)},get:(a,e={},t=!0)=>{magistraal.element.get("page-search").val(""),a=trim(a,"/");let s,i={"absences/list":magistraal.absences.paintList,"appointments/list":magistraal.appointments.paintList,"grades/list":magistraal.grades.paintList,"messages/list":magistraal.messages.paintList,logout:magistraal.logout.logout,"settings/list":magistraal.settings.paintList};void 0!==i[a]&&(s=i[a]);let l=magistraal.template.get(`page-buttons-${a}`),n=magistraal.element.get("page-buttons-container");return l.length>0?n.html(l.html()):n.html(""),$("body").attr("data-page-buttons",n.find(".btn").length),magistraal.element.get("page-title").text(magistraal.locale.translate(`page.${a}.title`)),new Promise(((i,l)=>{try{magistraal.page.request(a,e,s,t).then((a=>{i(a)})).catch((()=>{}))}catch{magistraal.console.error()}}))},request:(a,e={},t=null,s=!0)=>new Promise(((i,l)=>{magistraal.console.loading("console.loading.refresh"),magistraal.api.call({url:a,data:e,source:"both",cachable:s,callback:t,scope:a}).then((a=>{magistraal.console.success("console.success.refresh"),i(a)})).catch((a=>{l(a)}))})),current:()=>trim(window.location.hash.substring(1).replace(/[^a-zA-Z\/]/g,""),"/"),setContent:(a="")=>{$("main").html(a)}},login:{login:a=>{let e=a.attr("action");magistraal.console.loading("console.loading.login"),magistraal.api.call(e,a.serialize()).then((a=>{let e=a.request.getResponseHeader("X-Auth-Token");if(!e)return magistraal.console.error(`console.error.${null==a?void 0:a.info}`),!1;magistraalStorage.set("token",e),magistraal.console.success("console.success.login"),window.location.href="../main/"})).catch((a=>{var e;magistraal.console.error(`console.error.${null==a||null===(e=a.responseJSON)||void 0===e?void 0:e.info}`)}))}},inputs:{tagsInput:class{constructor(a){this.$input=a,this.setup()}setup(){0==this.$input.closest(".input-wrapper").length&&this.$input.wrap('<div class="input-wrapper"></div>'),this.$wrapper=this.$input.closest(".input-wrapper"),this.$wrapper.addClass("input-tags-wrapper"),this.$tags=$('<ul class="input-tags-list"></ul>'),this.$tags.appendTo(this.$wrapper),this.$wrapper.hasClass("input-search-wrapper")&&(this.$inputGhost=$('<input type="text" class="form-control input-search input-ghost">'),this.$inputGhost.appendTo(this.$wrapper),this.$tags.append(this.$input.removeClass("input-search").detach())),this.$input.on("click",(a=>{this.eventFocus(a)})),this.$wrapper.on("focusout",(a=>{this.eventFocusOut(a)})),this.$input.on("magistraal.change",(a=>{this.eventChange(a)})),this.$input.on("keyup",(a=>{this.eventKeyup(a)}))}eventFocus(a){this.$inputGhost.addClass("focus")}eventFocusOut(a){this.$inputGhost.removeClass("focus")}eventChange(a){var e,t;null!=typeof a.addTag&&this.$input.addTag(null===(e=a.addTag)||void 0===e?void 0:e.value,null===(t=a.addTag)||void 0===t?void 0:t.text)}eventKeyup(a){if(8==a.which){let a=this.$tags.find(".input-tags-tag:last-of-type").attr("value");this.$input.removeTag(a)}}},searchInput:class{constructor(a){this.$input=a,this.setup()}results={set:a=>{let e="";$.each(a,(function(a,t){e+=`<li class="input-search-result input-search-result-rich" value="${t.value}"><i class="input-search-result-icon ${null==t?void 0:t.icon}"></i><span class="input-search-result-title">${t.title}</span><span class="input-search-result-description">${t.description}</span></li>`})),this.$results.html(e)}};setup(){0==this.$input.closest(".input-wrapper").length&&this.$input.wrap('<div class="input-wrapper"></div>'),this.$wrapper=this.$input.closest(".input-wrapper"),this.$wrapper.addClass("input-search-wrapper"),this.$results=$('<ul class="input-search-results"></ul>'),this.$results.appendTo(this.$wrapper),this.$input.attr("placeholder")||this.$input.attr("placeholder",magistraal.locale.translate("generic.action.search")),this.$input.on("click",(a=>{this.eventFocus(a)})),this.$input.on("focusout",(a=>{this.eventFocusOut(a)})),this.$input.on("input",debounce((a=>{this.eventInputDebounced(a)}),250)),this.$input.on("magistraal.change",(a=>{this.eventChange(a)})),this.$results.on("click",".input-search-result",(a=>{this.eventResultClick(a)}))}eventFocus(a){this.$wrapper.addClass("active")}eventFocusOut(a){setTimeout((()=>{this.$wrapper.removeClass("active")}),50)}eventInputDebounced(a){if(void 0!==this.$input.attr("data-magistraal-search-api")){let a=this.$input.attr("data-magistraal-search-api"),e=this.$input.val()||this.$input.text();magistraal.api.call({url:`${a}/search`,data:{query:e},cachable:!1}).then((e=>{let t=magistraal.inputs.search.remap_api_response(a,e);this.results.set(t)})).catch((a=>{}))}}eventResultClick(a){var e;let t=$(a.target).closest(".input-search-result"),s=t.attr("value"),i=(null===(e=t.find(".input-search-result-title"))||void 0===e?void 0:e.text())||t.text();if(this.$input.val(""),this.$wrapper.hasClass("input-tags-wrapper")){this.$wrapper.find(".input-tags").trigger({type:"magistraal.change",addTag:{value:s,text:i}}),this.$input.focus(),setTimeout((()=>{var a;this.$wrapper.addClass("active"),null===(a=this.$wrapper.find(".input-ghost"))||void 0===a||a.addClass("focus")}),50)}}eventChange(a){}},search:{remap_api_response:(a,e)=>{let t=[];switch(a){case"people":$.each(e,(function(a,e){t.push({icon:"student"==e.type?"fal fa-book-open":"fal fa-briefcase",title:""==e.infix?`${e.first_name} ${e.last_name}`:`${e.first_name} ${e.infix} ${e.last_name}`,description:e.course||e.abbr||magistraal.locale.translate(`people.type.${e.type}`),value:e.id})}));break}return t}}},logout:{logout:()=>{magistraal.page.request("logout",{}).finally((()=>{magistraalPersistentStorage.clear(),magistraal.page.load("login")}))}},sidebar:{addFeed:(a=null,e)=>((a=a||magistraal.element.get("sidebar")).attr("data-sidebar-feed",encodeURI(JSON.stringify(e))),!0),tableValueEditable(a,e=!0){magistraal.element.get("sidebar-table").find(`.sidebar-table-key[data-key="${a}"]`).next(".sidebar-table-value").attr({"data-editable":e,contenteditable:e})},clearFeed:()=>magistraal.sidebar.selectFeed(null),getFeed:(a=null)=>(a=a||magistraal.element.get("sidebar"),JSON.parse(decodeURI(a.attr("data-sidebar-feed")||"{}"))),selectFeed:(a,e=!0)=>{if(null==a)return magistraal.sidebar.setFeed(void 0,!1);$(`[class="${a.attr("class")}"]`).removeAttr("data-selected"),a.attr("data-selected",!0),magistraal.sidebar.setFeed(magistraal.sidebar.getFeed(a),e)},setFeed:(a={title:"",subtitle:"",table:{},actions:{}},e=!0)=>{let t=magistraal.element.get("sidebar-table"),s=magistraal.element.get("sidebar-actions");magistraal.element.get("sidebar-title").text(a.title),magistraal.element.get("sidebar-subtitle").text(a.subtitle),t.empty(),s.empty(),magistraal.sidebar.addFeed(void 0,a),$.each(a.table,(function(a,e){if(""==a||""==e)return!0;let s=magistraal.template.get("sidebar-table-key");s.attr("data-key",a).text(magistraal.locale.translate(`sidebar.table.info.${a}`)),s.appendTo(t);let i=magistraal.template.get("sidebar-table-value");i.html(e),i.appendTo(t)})),$.each(a.actions,(function(a,e){let t=magistraal.template.get("sidebar-action"),i="delete"==a?"danger":"secondary";t.addClass(`btn-${i}`),t.html(`\n\t\t\t\t\t<i class="${e?.icon} action-icon"></i>\n\t\t\t\t\t<span class="action-text">${magistraal.locale.translate(`generic.action.${a}`)}</span>\n\t\t\t\t`),t.attr({"data-action":a,onclick:e?.handler}),t.appendTo(s)})),e&&setTimeout((()=>{magistraal.sidebar.open()}),50)},updateFeed:(a,e)=>{let t={title:"",subtitle:"",table:{},actions:{}},s=magistraal.sidebar.getFeed(),i=Object.keys(s.table).length;t.title=a?.title||s.title,t.subtitle=a?.subtitle||s.subtitle;let l=1;$.each(s.table,(function(s,n){t.table[s]=n,s!=e&&l!=i||$.each(a.table,(function(a,e){t.table[a]=e})),l++})),t.actions=s.actions,magistraal.sidebar.setFeed(t,!1)},currentFeed(){let a=magistraal.element.get("sidebar");return JSON.parse(decodeURI(a.attr("data-sidebar-feed")||"{}"))},open:()=>{$("body").attr("data-sidebar-active",!0),magistraalStorage.set("sidebar_active",!0)},close:()=>{$("body").attr("data-sidebar-active",!1),magistraalStorage.set("sidebar_active",!1)},toggle:()=>{"true"==magistraalStorage.get("sidebar_active")?magistraal.sidebar.close():magistraal.sidebar.open()}},popup:{get:a=>$(`[data-magistraal-popup="${a}"]`).first(),open:a=>{let e=magistraal.popup.get(a);if(0===e.length)return!1;magistraal.element.get("popup-backdrop").addClass("show"),magistraal.popup.enable(a),e.addClass("show")},close:a=>{let e=magistraal.popup.get(a);if(0===e.length)return!1;magistraal.element.get("popup-backdrop").removeClass("show"),magistraal.popup.disable(a),e.removeClass("show")},enable:a=>{magistraal.popup.get(a).find("[data-popup-action]").removeAttr("disabled")},disable:a=>{magistraal.popup.get(a).find("[data-popup-action]").attr("disabled","disabled")}},template:{get:a=>$(`[data-magistraal-template="${a}"]`).first().clone().removeAttr("data-magistraal-template")},element:{get:a=>$(`[data-magistraal="${a}"]`)},mapping:{icons(a,e){switch(a){case"file_icons":return"application/msword"==e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==e?"fal fa-file-word":"application/vnd.ms-powerpoint"==e||"application/vnd.openxmlformats-officedocument.presentationml.presentation"==e?"fal fa-file-powerpoint":"application/pdf"==e?"fal fa-file-pdf":e.includes("image/")?"fal fa-file-image":e.includes("video/")?"fal fa-file-video":e.includes("audio/")?"fal fa-file-audio":e.includes("text/")?"fal fa-file-alt":"application/zip"==e||"application/x-zip-compressed"==e||"application/x-7z-compressed"==e||"application/vnd.rar"==e||"application/x-bzip"==e||"application/x-bzip2"==e?"fal fa-file-archive":"fal fa-file"}return"fal fa-question"}}};