let _magistraalStorage={};const magistraalStorage={get:a=>{const e=_magistraalStorage[a];return isSet(e)?e:{value:void 0,storedAt:Date.now()}},set:(a,e)=>{const t={value:e,storedAt:Date.now()};return _magistraalStorage[a]=t,!0},remove:a=>(isSet(_magistraalStorage[a])&&delete magistraalStorage[a],!0)},magistraalPersistentStorage={get:a=>{try{const e=JSON.parse(localStorage.getItem(`magistraal.${a}`));return isSet(e)?e:{value:void 0,storedAt:Date.now()}}catch(a){return{value:void 0,storedAt:Date.now()}}},set:(a,e)=>{const t={value:e,storedAt:Date.now()};return localStorage.setItem(`magistraal.${a}`,JSON.stringify(t))},remove:a=>magistraalPersistentStorage.set(a,void 0),clear:(a=!1)=>{let e=[];for(let t=0;t<localStorage.length;t++){let s=localStorage.key(t);"magistraal"==s.substring(0,10)&&("magistraal.version"!=s&&"magistraal.api_response.locale"!=s&&("magistraal.user_uuid"==s&&a||e.push(localStorage.key(t))))}for(let a=0;a<e.length;a++)localStorage.removeItem(e[a]);return a||magistraal.token.delete(),!0}},magistraal={api:{call:(a={})=>(isSet(a.callback)||(a.callback=function(){}),isSet(a.source)||(a.source="both"),isSet(a.scope)||(a.scope=magistraal.page.current()),!!isSet(a.url)&&(isSet(a.data)||(a.data={}),isSet(a.cachable)||(a.cachable="server_only"!=a.source),isSet(a.xhrFields)||(a.xhrFields={}),isSet(a.alwaysReturn)||(a.alwaysReturn={}),isSet(a.cacheMaxAge)||(a.cacheMaxAge=259200),isSet(a.inBackground)||(a.inBackground=!1),isSet(a.callbackData)||(a.callbackData={}),new Promise(((e,t)=>{if(a.cachable&&"server_only"!=a.source){const t=magistraalPersistentStorage.get(`api_response.${a.url}.${JSON.stringify(a.data)}`),s=t.value;if(isSet(s))if(a.cacheMaxAge<0||"prefer_cache"==a.source&&Date.now()-t.storedAt<=1e3*a.cacheMaxAge)try{return e(s),void("function"==typeof a.callback&&a.callback(s,"cache_final",void 0,a.url,a.callbackData))}catch(e){!0!==a.inBackground&&magistraal.console.error()}else try{e(s),"function"==typeof a.callback&&a.callback(s,"cache_pre",void 0,a.url,a.callbackData)}catch(e){!0!==a.inBackground&&magistraal.console.error()}}a.xhrFields.withCredentials=!0,$.ajax({method:"POST",url:`/magistraal/api/${a.url}/`,data:a.data,headers:{Accept:"*/*"},xhrFields:a.xhrFields,cache:!1,success:function(t,s,i){if(!0===a.inBackground||!isSet(a.scope)||a.scope.trim()==magistraal.page.current().trim())if(isSet(t.success)&&!0===t.success&&isSet(t.data)){a.cachable&&magistraalPersistentStorage.set(`api_response.${a.url}.${JSON.stringify(a.data)}`,t);try{e(t),"function"==typeof a.callback&&a.callback(t,"server_final",i,a.url,a.callbackData)}catch(e){!0!==a.inBackground&&magistraal.console.error()}}else try{a.alwaysReturn&&(e(t),"function"==typeof a.callback&&a.callback(t,"server_final",i,a.url,a.callbackData))}catch(e){!0!==a.inBackground&&magistraal.console.error()}},error:function(s,i){if(!0!==a.inBackground&&isSet(s.responseJSON)&&isSet(s.responseJSON.info)&&s.responseJSON.info.includes("token_invalid")){return void magistraal.console.error();magistraal.console.error()}if(!isSet(a.scope)||a.scope==magistraal.page.current())if(0!=s.readyState||0!=s.status)(isSet(s.responseJSON)&&isSet(s.responseJSON.info)||a.alwaysReturn)&&(t(s),"function"==typeof a.callback&&a.callback(s,"cache_final",void 0,a.url,a.callbackData)),!0!==a.inBackground&&magistraal.console.error();else{const s=magistraalPersistentStorage.get(`api_response.${a.url}.${JSON.stringify(a.data)}`);if(isSet(s.value))try{e(s.value),"function"==typeof a.callback&&a.callback(s.value,"cache_final",void 0,a.url,a.callbackData);const t=(new Date).toDateString()==new Date(s.storedAt).toDateString(),i=magistraal.locale.formatDate(s.storedAt/1e3,t?"H:i":"d-m-Y H:i");magistraal.console.info(`${magistraal.locale.translate("console.info.last_updated")} ${i}`)}catch(i){magistraal.console.error()}else t(),magistraal.console.error("console.error.because_offline")}}})}))))},absences:{paintList:(a,e)=>{let t=new responsiveCarousel("x");$.each(a.data,(function(a,e){if(0==e.absences.length)return!0;let s=magistraal.template.get("list");s.find(".list-title").text(capitalizeFirst(magistraal.locale.formatDate(e.time,"F Y"))),$.each(e.absences,(function(a,e){let t=magistraal.template.get("absence-list-item");t.find(".list-item-title").html(e.appointment.description+'<span class="bullet"></span>'+magistraal.locale.formatDate(e.appointment.start.time,"H:i")+" - "+magistraal.locale.formatDate(e.appointment.end.time,"H:i")),t.find(".list-item-icon").text(e.lesson||e.code),t.find(".list-item-content").text(e.description),t.attr({"data-interesting":!0,"data-permitted":e.permitted,"data-search":e.description,"data-type":e.type}),magistraal.sidebar.addFeed(t,{title:e.appointment.description,subtitle:e.description,table:{"absence.date":capitalizeFirst(magistraal.locale.formatDate(e.appointment.start.time,"l d F Y")),"absence.time":magistraal.locale.formatDate(e.appointment.start.time,"H:i")+" - "+magistraal.locale.formatDate(e.appointment.end.time,"H:i"),"absence.lesson":e.lesson,"absence.permitted":magistraal.locale.formatBoolean(e.permitted)}}),t.appendTo(s)})),t.addSlide(s)})),magistraal.page.setContent(t.jQueryObject(),!1,e),t.reloadIndicator(e.includes("final"))},selectYearHandler:a=>{let e=parseInt(a.year_to||0),t="31-07-"+e,s="01-08-"+(e-1);magistraal.page.load({page:"absences/list",data:{from:s,to:t},scopeIgnoreQuery:!0})}},account:{paintList:(a,e)=>{const t=$("<div></div>");$.each({personal:["full_name","full_name_official"],contact:["email","phone"]},(function(e,s){const i=magistraal.template.get("account-group");i.find(".account-group-title").text(magistraal.locale.translate(`account.group.${e}.title`)),$.each(s,(function(t,s){const l=magistraal.template.get("account-list-item");l.find(".list-item-title").text(magistraal.locale.translate(`account.item.${s}.title`)),l.find(".list-item-content").text(a.data[e][s]||magistraal.locale.translate("generic.invalid")),l.find(".list-item-icon").html(`<i class="${magistraal.mapping.icons("account_items_icons",s)}"></i>`),l.attr("data-search",a.data[e][s]||null),l.appendTo(i)})),i.appendTo(t)}));const s=magistraal.template.get("account-group");s.find(".account-group-title").text(magistraal.locale.translate("account.group.residences.title")),$.each(a.data.residences,(function(a,e){if("live"!=e.type)return!0;const t=magistraal.template.get("account-list-item");t.find(".list-item-title").text(`${e.street} ${e.street_number}${e.street_number_suffix}`),t.find(".list-item-content").html(`${e.postal_code}, ${e.place}`),t.find(".list-item-icon").html(`<i class="${magistraal.mapping.icons("account_items_icons","residence")}"></i>`),t.attr("data-search",`${e.street} ${e.street_number}${e.street_number_suffix} ${e.postal_code}, ${e.place}`),t.appendTo(s)})),s.appendTo(t),magistraal.page.setContent(t,!0,e)}},appointments:{paintList:(a,e)=>{let t=new responsiveCarousel("x");$.each(a.data,(function(a,e){let s=magistraal.template.get("list");if(s.find(".list-title").text(capitalizeFirst(magistraal.locale.formatDate(e.time,"l d F"))),0==e.items.length){return magistraal.template.get("list-message-empty").appendTo(s),!0}$.each(e.items,(function(a,e){let t=magistraal.template.get("appointment");e.editable="personal"==e.type||"planning"==e.type,t.attr({"data-editable":e.editable,"data-finishable":!0,"data-finished":e.finished,"data-has-attachments":e.has_attachments,"data-has-meeting-link":e.has_meeting_link,"data-meeting-link":e.meeting_link,"data-id":e.id,"data-info-type":e.info_type,"data-interesting":"canceled"!=e.status,"data-search":`${e.subjects.join(", ")} ${e.description} ${e.content_text}`.trim(),"data-status":e.status,"data-type":e.type,"data-start":e.start.time,"data-end":e.end.time}),e.start.lesson>0?t.find(".list-item-icon").text(e.duration.lessons<=1?e.start.lesson:`${e.start.lesson}-${e.end.lesson}`):t.find(".list-item-icon").html('<i class="fal fa-info"></i>'),t.find(".appointment-time").text(magistraal.locale.formatDate(e.start.time,"H:i")+" - "+magistraal.locale.formatDate(e.end.time,"H:i")),t.find(".appointment-description").text(""==e.facility?e.description:`${e.description} (${e.facility})`),t.find(".list-item-content").html(e.content_text);const i=magistraal.locale.translate(`appointments.appointment.info_type.${e.info_type}`);t.find(".list-item-action-primary").text(i);let l={id:e.id,title:e.description,subtitle:`${magistraal.locale.formatDate(e.start.time,"H:i")} - ${magistraal.locale.formatDate(e.end.time,"H:i")}`,table:{"appointment.facility":e.facility,"appointment.start":capitalizeFirst(magistraal.locale.formatDate(e.start.time,"l d F Y H:i")),"appointment.end":capitalizeFirst(magistraal.locale.formatDate(e.end.time,"l d F Y H:i")),"appointment.school_subject":e.subjects.join(", ")},actions:{}};l.table[`appointment.info_type.${e.info_type}`]=e.content,l.table["appointment.teachers"]=e.teachers.join(", "),e.editable&&(l.actions.delete={handler:`magistraal.appointments.delete('${e.id}')`,icon:"fal fa-trash"},l.actions.edit={handler:`magistraal.appointments.edit(${JSON.stringify(e)})`,icon:"fal fa-pencil-alt"}),l.actions.finish={handler:`magistraal.appointments.finish('${e.id}', $('.appointment-list-item[data-id="${e.id}"]').attr('data-finished') != 'true');`,icon:"fal fa-check-circle"},e.has_meeting_link&&(l.actions.join_meeting={handler:`magistraal.appointments.joinMeeting('${e.meeting_link}');`,icon:"fal fa-users"}),magistraal.sidebar.addFeed(t,l),t.appendTo(s)})),t.addSlide(s,12)})),t.scrollCallback=magistraal.appointments.carouselLoadSlides,magistraal.page.setContent(t.jQueryObject(),!1,e),t.reloadIndicator(e.includes("final"))},carouselLoadSlides:(a,e)=>{const t=a.getSlideIndex(),s=a.getSlideCount();let i=0;if(t<=2){}else{if(!(s-t<=2))return;i=1}const l=e.find(".appointment-list-item").first(),r=new Date(l.attr("data-start")),n=new Date(r-6048e5),o=n.getDay(),c=n.getDate()-o+(0===o?-6:1),d=new Date(n.setDate(c));magistraal.api.call({url:"appointments/list",data:{from:magistraal.locale.formatDate(d,"d-m-Y")}}).then((a=>{}))},view:a=>{if("true"!=$(`.appointment-list-item[data-id="${a}"]`).attr("data-has-attachments"))return!1;magistraal.console.loading("console.loading.appointment_attachments"),magistraal.api.call({url:"appointments/info",data:{id:a},callback:magistraal.appointments.viewCallback,inBackground:!0})},viewCallback:(a,e)=>{let t="";const s=a.data;magistraal.sidebar.getId(s.id)==s.id?(s.attachments.length>0&&$.each(s.attachments,(function(a,e){e.icon=magistraal.mapping.icons("file_icons",e.mime_type),t+=`<div class="anchor" onclick="magistraal.files.download('${e.location}');"><i class="${e.icon} icon-inline"></i>${e.name}.${e.type}</div>`})),magistraal.sidebar.updateFeed({table:{"appointment.attachments":t}},"appointment.end"),"server_final"==e&&magistraal.console.success("console.success.appointment_attachments")):magistraal.console.clear()},joinMeeting:a=>{window.open(a,"_blank","noopener")},finish:(a,e)=>{const t=$(`.appointment-list-item[data-id="${a}"]`);if("true"!=t.attr("data-finishable"))return!1;t.attr("data-finished",e),magistraal.console.loading(e?"console.loading.finish_appointment":"console.loading.unfinish_appointment"),magistraal.api.call({url:"appointments/finish",data:{id:a,finished:e},source:"both"}).then((()=>{magistraal.console.success(e?"console.success.finish_appointment":"console.success.unfinish_appointment")})).catch((()=>{$(`.appointment-list-item[data-id="${a}"]`).attr("data-finished",!e)}))},create:(a,e)=>{magistraal.console.loading("console.loading.create_appointment"),magistraal.sidebar.actionEnded("create",!0);let t=new Date(a.date);t.setHours(a.start.hours,a.start.minutes,0),a.start=t.toISOString();let s=new Date(a.date);s.setHours(a.end.hours,a.end.minutes,1),a.end=s.toISOString(),magistraal.api.call({url:"appointments/create",data:a,source:"server_only"}).then((a=>{magistraal.console.success("console.success.create_appointment"),magistraal.page.reload(),e&&e.formReset()})).catch((a=>{if(magistraal.popup.open("appointments_create_appointment"),a.responseJSON&&a.responseJSON.info)return magistraal.console.error(`console.error.${a.responseJSON.info}`),!1}))},edit:a=>{const e=magistraal.element.get("form-appointments_create_appointment");e.find('[name="id"]').value(a.id),e.find('[name="date"]').value(a.start.time),e.find('[name="start"]').value(a.start.time),e.find('[name="end"]').value(a.end.time),e.find('[name="facility"]').value(a.facility),e.find('[name="description"]').value(a.description),e.find('[name="content"]').value(a.content),magistraal.popup.open("appointments_create_appointment"),magistraal.sidebar.actionEnded("edit",!0)},delete:a=>{const e=$(`.appointment-list-item[data-id="${a}"]`),t=e.parent(),s=e.closest(".list-group");magistraal.console.loading("console.loading.delete_appointment"),magistraal.api.call({url:"appointments/delete",data:{id:a},source:"server_only"}).then((a=>{magistraal.console.success("console.success.delete_appointment"),e.remove(),0==t.children().length&&s.remove()})).catch((a=>{if(a.responseJSON&&a.responseJSON.info)return magistraal.console.error(`console.error.${a.responseJSON.info}`),!1})).then((a=>{magistraal.sidebar.actionEnded("delete",!0)}))}},files:{download:a=>(magistraal.console.loading("console.loading.download"),new Promise(((e,t)=>{magistraal.api.call({url:"files/download",data:{location:a},source:"server_only",callback:magistraal.files.downloadCallback,xhrFields:{responseType:"arraybuffer"},alwaysReturn:!0}).then((a=>{e()})).catch((a=>{e()}))}))),downloadCallback(a,e,t,s){let i=new Blob([a],{type:t.getResponseHeader("Content-Type")}),l=document.createElement("a");l.href=URL.createObjectURL(i),l.download=decodeURI((t.getResponseHeader("Content-Disposition")??"filename=Bestand").split("filename=")[1]),l.click(),l.remove(),magistraal.console.success("console.success.download")}},grades:{paintList:(a,e)=>{const t=$("<div></div>");$.each(a.data,(function(a,e){const s=magistraal.template.get("grade-list-item"),i=capitalizeFirst(magistraal.locale.formatDate(e.entered_at,"l d F Y H:i"));s.attr({"data-counts":e.counts,"data-exemption":e.exemption,"data-interesting":!0,"data-sufficient":e.is_sufficient,"data-search":`${e.value_str} ${e.subject.description} ${e.description} ${i}`,"data-value":e.value,"data-weight":e.weight}),s.find(".list-item-icon").text(e.value_str),s.find(".grade-subject").text(e.subject.description),s.find(".grade-description").text(e.description),s.find(".grade-weight").text(`${e.weight}x`),s.find(".grade-entered-at").text(i);let l={id:e.column_id,title:e.subject.description,subtitle:capitalizeFirst(e.description),table:{"grade.value":e.value_str,"grade.weight":`${e.weight}x`,"grade.entered_at":capitalizeFirst(i),"grade.counts":magistraal.locale.formatBoolean(e.counts),"grade.exemption":magistraal.locale.formatBoolean(e.exemption)}};magistraal.sidebar.addFeed(s,l),s.appendTo(t)})),magistraal.page.setContent(t,!0,e)},paintOverview:(a,e)=>{let t=new responsiveCarousel("x"),s={};$.each(a.data.grades,(function(a,e){return"averages"!=e.column.type||(!isSet(e.value)||(isSet(s[e.term.id])||(s[e.term.id]=[]),void s[e.term.id].push(e)))})),$.each(s,(function(a,e){const s=magistraal.template.get("list");s.find(".list-title").text(magistraal.locale.translate("grades.grade_term")+" "+e[0].term.description),e=e.sort((function(a,e){return a.subject.description.localeCompare(e.subject.description)}));let i=0,l=0;$.each(e,(function(a,e){i+=e.value,l+=1;const t=magistraal.template.get("grade-overview-list-item"),r=capitalizeFirst(magistraal.locale.formatDate(e.entered_at,"l d F Y H:i")),n=magistraal.locale.translate("grades.term_average")+" "+e.term.description;t.find(".list-item-icon").text(e.value_str),t.find(".grade-subject").text(e.subject.description),t.find(".grade-description").text(n),t.find(".grade-sufficient").text(magistraal.locale.formatBoolean(e.value>=5.5)),t.find(".grade-entered-at").text(r),t.attr({"data-counts":e.counts,"data-exemption":e.exemption,"data-interesting":!0,"data-sufficient":e.is_sufficient,"data-search":`${e.value_str} ${e.subject.description} ${r}`,"data-value":e.value});let o={id:e.id,title:e.subject.description,subtitle:n,table:{"grade.value":e.value_str,"grade.entered_at":capitalizeFirst(r),"grade.counts":magistraal.locale.formatBoolean(e.counts),"grade.exemption":magistraal.locale.formatBoolean(e.exemption)}};magistraal.sidebar.addFeed(t,o),t.appendTo(s)}));const r=parseFloat((i/l).toFixed(1)),n=isSet(e[0])&&isSet(e[0].value_str)?e[0].value_str.includes(",")||e[0].value_str.includes("."):1,o=magistraal.locale.translate("grades.term_average_total")+" "+e[0].term.description,c=magistraal.template.get("grade-overview-list-item-average");c.attr({"data-interesting":!1,"data-sufficient":r>=5.5,"data-search":o,"data-value":r}),c.find(".list-item-icon").text(r.toFixed(n).toString().replace(".",",")),c.find(".grade-subject").text(o),c.find(".grade-description").text(l+" "+magistraal.locale.translate("grades.term_grades_amount")),c.appendTo(s),t.addSlide(s)})),magistraal.page.setContent(t.jQueryObject(),!1,e),t.reloadIndicator(e.includes("final"))},paintCalculator:()=>{$listItem=magistraal.template.get("grade-calculator-list-item"),$listItem.clone(!0).appendTo("main")}},learningresources:{paintList:(a,e)=>{const t=$("<div></div>");$.each(a.data,(function(a,e){const s=magistraal.template.get("learning-resource");s.find(".list-item-icon").html('<i class="fal fa-books"></i>'),s.find(".list-item-title").text(e.description),s.find(".list-item-content").text(e.subject.description),s.attr("data-search",e.subject.description+" "+e.description);let i={id:e.id,title:e.description,subtitle:e.subject.description,table:{"learningresource.ean":e.id},actions:{open:{handler:`magistraal.learningresources.open('${e.id}')`,icon:"fal fa-external-link"}}};magistraal.sidebar.addFeed(s,i),s.appendTo(t)})),magistraal.page.setContent(t,!0,e)},open:a=>{magistraal.console.loading(),magistraal.api.call({url:"learningresources/info",data:{id:a},source:"server_only"}).then((a=>{isSet(a.data.location)?(magistraal.console.success(),window.open(a.data.location,"_blank","noopener")):magistraal.console.error()}))}},messages:{paintList:(a,e)=>{if(parseInt(magistraal.settings.get("data_usage.prefer_level"))>0)for(let e=0;e<5;e++)isSet(a.data.items[e])&&isSet(a.data.items[e].id)&&magistraal.api.call({url:"messages/info",data:{id:String(a.data.items[e].id)},source:"prefer_cache"});const t=$("<div></div>");$.each(a.data.items,(function(e,s){const i=magistraal.template.get("message-list-item"),l=capitalizeFirst(magistraal.locale.formatDate(s.sent_at,"l d F Y H:i"));let r;s.subject=s.subject||magistraal.locale.translate("messages.subject.no_subject"),i.find(".list-item-title").text(s.subject),i.find(".list-item-side-title").text(),i.find(".list-item-content").text(s.sender.name||l),i.attr({"data-id":s.id,"data-interesting":!0,"data-priority":s.priority,"data-has-attachments":s.has_attachments,"data-read":s.read,"data-search":s.subject+s.sender.name}),r="inbox"==a.folder?{id:s.id,title:s.subject,subtitle:s.sender.name,table:{"message.sender":s.sender.name,"message.sent_at":l}}:{id:s.id,title:s.subject,subtitle:capitalizeFirst(magistraal.locale.formatDate(s.sent_at,"l d F Y H:i")),table:{}},r.actions={delete:{handler:`magistraal.messages.delete('${s.id}')`,icon:"fal fa-trash"}},magistraal.sidebar.addFeed(i,r),i.appendTo(t)})),magistraal.page.setContent(t,!0,e)},view:(a,e=!0)=>{const t=$(`.message-list-item[data-id="${a}"]`);magistraal.console.loading("console.loading.message_content"),magistraal.api.call({url:"messages/info",data:{id:a},callback:magistraal.messages.viewCallback,source:"prefer_cache",cacheMaxAge:-1,inBackground:!0}).then((s=>{if(!e){const e=magistraal.element.get("unread-messages-amount-badge"),s=parseInt(e.text()||0);magistraal.messages.paintBadge({data:{amount_unread:s-1}}),magistraal.api.call({url:"messages/read",data:{id:a,read:!0},source:"server_only",inBackground:!0}).then((a=>{t.attr("data-read",!0),magistraal.api.call({url:"messages/list",source:"server_only",data:{filter:["id"]},inBackground:!0,callback:magistraal.messages.paintBadge})}))}}))},viewCallback:(a,e)=>{let t="";const s=a.data;if(magistraal.sidebar.getId(s.id)!=s.id)return void magistraal.console.clear();s.attachments.length>0&&$.each(s.attachments,(function(a,e){e.icon=magistraal.mapping.icons("file_icons",e.mime_type),t+=`<div class="anchor" onclick="magistraal.files.download('${e.location}');"><i class="${e.icon} mr-1"></i>${e.name}.${e.type}</div>`}));let i={table:{"message.sender":s.sender.name,"message.to":s.recipients.to.names.join(", "),"message.cc":s.recipients.cc.names.join(", "),"message.bcc":s.recipients.bcc.names.join(", "),"message.attachments":t,"message.content":s.content},actions:{forward:{handler:`magistraal.messages.forward(${JSON.stringify(s)})`,icon:"fal fa-arrow-alt-right"},reply:{handler:`magistraal.messages.reply(${JSON.stringify(s)})`,icon:"fal fa-reply"}}};magistraal.sidebar.updateFeed(i,void 0),e.includes("final")&&$(`.message-list-item[data-id="${s.id}"]`).length>0&&magistraal.console.success("console.success.message_content")},send:(a,e)=>{magistraal.console.loading("console.loading.send_message"),magistraal.sidebar.actionEnded("send",!0),magistraal.api.call({url:"messages/send",data:a,source:"server_only",inBackground:!0}).then((a=>{magistraal.console.success("console.success.send_message"),magistraal.page.reload(),e&&e.formReset()})).catch((a=>{magistraal.popup.open("messages_write_message"),magistraal.console.error(`console.error.${a.responseJSON?.info}`)}))},delete:a=>{const e=$(`.message-list-item[data-id="${a}"]`);magistraal.console.loading("console.loading.delete_message"),magistraal.api.call({url:"messages/delete",data:{id:a},source:"server_only"}).then((a=>{magistraal.console.success("console.success.delete_message"),e.remove(),magistraal.page.selectInterestingListItem(0,!0)})).catch((a=>{if(a.responseJSON&&a.responseJSON.info)return magistraal.console.error(`console.error.${a.responseJSON.info}`),!1})).finallly((a=>{magistraal.sidebar.actionEnded("delete",!0)}))},forward:a=>{const e=magistraal.element.get("form-messages_write_message");e.find('[name="id"]').value(a.id),e.find('[name="subject"]').value(magistraal.locale.translate("message.forward.prefix")+": "+a.subject);const t=`\n\t\t\t\t<br><br><br><hr>\n\t\t\t\t<b>${magistraal.locale.translate("messages.popup.write_message.item.from.title")}</b>: ${a.sender.name}<br>\n\t\t\t\t<b>${magistraal.locale.translate("messages.popup.write_message.item.sent_at.title")}</b>: ${magistraal.locale.formatDate(a.sent_at,"l d F Y H:i")}<br>\n\t\t\t\t`+(a.recipients.to.list.length>0?`<b>${magistraal.locale.translate("messages.popup.write_message.item.to.title")}</b>: ${a.recipients.to.names.join(", ")}<br>`:"")+"\n\t\t\t\t"+(a.recipients.cc.list.length>0?`<b>${magistraal.locale.translate("messages.popup.write_message.item.cc.title")}</b>: ${a.recipients.cc.names.join(", ")}<br>`:"")+`\n\t\t\t\t<b>${magistraal.locale.translate("messages.popup.write_message.item.subject.title")}</b>: ${a.subject}<br><br>\n\t\t\t`+a.content;e.find('[name="content"]').value(t),magistraal.popup.open("messages_write_message"),magistraal.sidebar.actionEnded("forward",!0)},reply:a=>{const e=magistraal.element.get("form-messages_write_message");e.find('[name="id"]').value(a.id),e.find('[name="subject"]').value(magistraal.locale.translate("message.reply.prefix")+": "+a.subject);let t={to:{},cc:{},bcc:{}};$.each(a.recipients,(function(a,e){$.each(e.list,(function(e,s){t[a][s.id]=s.name}))}));let s={};s[a.sender.id]=a.sender.name,e.find('[name="to"]').setTags(s);const i=`\n\t\t\t\t<br><br><br><hr>\n\t\t\t\t<b>${magistraal.locale.translate("messages.popup.write_message.item.from.title")}</b>: ${a.sender.name}<br>\n\t\t\t\t<b>${magistraal.locale.translate("messages.popup.write_message.item.sent_at.title")}</b>: ${magistraal.locale.formatDate(a.sent_at,"l d F Y H:i")}<br>\n\t\t\t\t`+(a.recipients.to.list.length>0?`<b>${magistraal.locale.translate("messages.popup.write_message.item.to.title")}</b>: ${a.recipients.to.names.join(", ")}<br>`:"")+"\n\t\t\t\t"+(a.recipients.cc.list.length>0?`<b>${magistraal.locale.translate("messages.popup.write_message.item.cc.title")}</b>: ${a.recipients.cc.names.join(", ")}<br>`:"")+`\n\t\t\t\t<b>${magistraal.locale.translate("messages.popup.write_message.item.subject.title")}</b>: ${a.subject}<br><br>\n\t\t\t`+a.content;e.find('[name="content"]').value(i),magistraal.popup.open("messages_write_message"),magistraal.sidebar.actionEnded("reply",!0)},paintBadge:a=>{const e=a.data.amount_unread||0;magistraal.element.get("unread-messages-amount-badge").text(e).toggle(e>0)}},settings:{paintList:(a,e)=>{const t=magistraalPersistentStorage.get("settings").value||[],s=$("<div></div>");$.each(a.data.items,(function(e,i){let l;if(isSet(i.items)){l=magistraal.template.get("setting-category");const t=magistraal.locale.translate(`settings.category.${a.data.category}.${e}.title`);l.find(".setting-category-title").text(t),l.find(".setting-category-icon").html(`<i class="${i?.icon||"afal fa-cog"}"></i>`);let s="";const r=$("<div></div>");$.each(i.items,(function(a,t){if(isSet(t.items)){const t=magistraal.locale.translate(`settings.category.${e}.${a}.title`);r.append(`<span>${t}</span><span class="bullet"></span>`),s+=" "+t}else{const t=magistraal.locale.translate(`settings.setting.${e}.${a}.title`);r.append(`<span>${t}</span><span class="bullet"></span>`),s+=" "+t}})),r.find(".bullet:last-child").remove(),l.find(".setting-category-content").html(r.html()),l.attr("onclick",`magistraal.page.load({page: 'settings/list', data: {'category': '${e}'}, showBack: true});`),l.attr("data-search",t+" "+s)}else{l=magistraal.template.get("setting-list-item");let s=$('<input class="form-control input-search">'),r=`${a.data.category}.${e}`;switch(s.appendTo(l.find(".list-item-content")),isSet(t[r])&&(i.value=t[r]),r){case"appearance.theme":!isSet(i.value)||"dark_auto"!=i.value&&"light_auto"!=i.value||(i.value="auto");break;case"system.version":i.value=magistraalPersistentStorage.get("version").value||"-";break;case"system.user_uuid":i.value=magistraalPersistentStorage.get("user_uuid").value||"-";break;case"system.user_agent":i.value=navigator.userAgent||"-";break}let n=new magistraal.inputs.searchInput(s);const o=i?.value||i?.default||null,c=magistraal.locale.translate(`settings.setting.${r}.value.${isSet(i.values)&&isSet(i.values[o])&&isSet(i.values[o].title)?i.values[o].title:o}.title`,magistraal.locale.translate("generic.invalid"));let d=[];isSet(i.enabled)&&"true"!=i.enabled?(l.removeClass("list-item-with-input"),l.find(".list-item-content").text(o)):($.each(i.values,(function(a,e){const t=magistraal.locale.translate(`settings.setting.${r}.value.${e?.title}.title`);d.push({title:t,value:a,icon:e?.icon,description:e?.description||t})})),n.results.set(d),s.value(o),s.val(c),n.results.select(o));const g=magistraal.locale.translate(`settings.setting.${a.data.category}.${e}.title`);l.find(".list-item-title").text(g),l.find(".list-item-icon").html(`<i class="${i?.icon||"fal fa-cog"}"></i>`),l.attr({"data-setting":`${a.data.category}.${e}`,"data-reload":i?.options?.do_reload||!1,"data-search":g})}l.appendTo(s)})),magistraal.page.setContent(s,!0,e)},updateClient:a=>{isSet(a)||(a={});let e={};Object.assign(e,a),isSet(a["appearance.theme"])&&a["appearance.theme"].includes("auto")&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e["appearance.theme"]="dark_auto":e["appearance.theme"]="light_auto"),magistraalPersistentStorage.set("settings",a);let t="";$.each(e,(function(a,e){t+=`${a}=${e},`})),$("body").attr("data-settings",trim(t,","))},get:a=>magistraal.settings.get_all()[a],get_all:()=>magistraalPersistentStorage.get("settings").value,set:(a,e)=>(magistraal.console.loading("console.loading.save"),new Promise(((t,s)=>{magistraal.api.call({url:"user/settings/set",data:{setting:a,value:e},source:"server_only",inBackground:!0}).then((a=>{magistraal.settings.updateClient(a.data),magistraal.console.success("console.success.save"),t()})).catch((a=>{magistraal.console.error(),s()}))}))),set_all:a=>(magistraal.console.loading("console.loading.save"),new Promise(((e,t)=>{magistraal.api.call({url:"user/settings/set_all",data:{settings:a},source:"server_only",inBackground:!0}).then((a=>{magistraal.settings.updateClient(a.data),magistraal.console.success("console.success.save"),e()})).catch((a=>{magistraal.console.error(),t()}))})))},studyguides:{paintList:(a,e)=>{const t=$("<div></div>");$.each(a.data,(function(a,e){const s=magistraal.template.get("studyguide-list-item");s.find(".list-item-title").text(e.description),s.find(".list-item-icon").html('<i class="fal fa-map-signs"></i>'),s.attr({"data-search":e.description,onclick:`magistraal.studyguides.viewDetails('${e.id}');`}),parseInt(magistraal.settings.get("data_usage.prefer_level"))>0&&magistraal.api.call({url:"studyguides/info",data:{id:e.id.toString()},source:"prefer_cache",inBackground:!0}),s.appendTo(t)})),magistraal.page.setContent(t)},viewDetails:a=>{magistraal.page.load({page:"studyguides/info",data:{id:a},showBack:!0,source:"prefer_cache",scope:`studyguides/info?id=${a}`})},paintDetails:(a,e)=>{const t=$("<div></div>");$.each(a.data.details||[],(function(e,s){const i=magistraal.template.get("studyguide-list-item");parseInt(magistraal.settings.get("data_usage.prefer_level"))>0&&magistraal.api.call({url:"studyguides/sources",data:{id:a.data.id.toString(),detail_id:s.id.toString()},source:"prefer_cache",inBackground:!0}),i.find(".list-item-title").text(s.name),i.find(".list-item-icon").html('<i class="fal fa-folder"></i>'),i.find(".list-item-content").text(s.description),i.get(0).style.setProperty("--list-item-icon-background",s.color),i.attr({"data-search":s.title+" "+s.description,onclick:`magistraal.studyguides.viewSources('${a.data.id}', '${s.id}');`}),i.appendTo(t)})),magistraal.page.setContent(t)},viewSources:(a,e)=>{magistraal.page.load({page:"studyguides/sources",data:{id:a,detail_id:e},showBack:!0,source:"prefer_cache",scope:`studyguides/sources?id=${a}&detail_id=${e}`})}},sources:{paintList:(a,e)=>{const t=$("<div></div>");$.each(a.data,(function(a,e){const s=magistraal.template.get("source-list-item"),i=magistraal.mapping.icons("file_icons","file"==e.type?e.content_type:e.type),l=magistraal.mapping.translations("file_types","file"==e.type?e.content_type:e.type);if(s.find(".list-item-title").text(e.name),s.find(".list-item-content").text(l),s.find(".list-item-icon").html(`<i class="${i}"></i>`),s.attr("data-search",e.name),"folder"==e.type)s.attr("onclick",`magistraal.page.load({page: 'sources/list', data: {parent_id: '${e.id}'}, showBack: true, source: 'prefer_cache'});`),parseInt(magistraal.settings.get("data_usage.prefer_level"))>0&&magistraal.api.call({url:"sources/list",data:{parent_id:e.id.toString()},source:"prefer_cache",inBackground:!0});else if("file"==e.type){s.attr("onclick","magistraal.sidebar.selectFeed($(this))"),s.attr("data-interesting",!0);let a={id:e.id,title:e.name,subtitle:l,table:{"sources.size":magistraal.locale.formatFileSize(e.size)},actions:{download:{handler:`$(this).attr('disabled', 'disabled'); magistraal.files.download('${e.location}').then(response => { $(this).removeAttr('disabled'); })`,icon:"fal fa-arrow-to-bottom"}}};magistraal.sidebar.addFeed(s,a)}else if("link"==e.type){s.attr("onclick","magistraal.sidebar.selectFeed($(this))"),s.attr("data-interesting",!0);let a={id:e.id,title:e.name,subtitle:l,table:{"sources.link":e.location},actions:{open:{handler:`window.open('${e.location}', '_blank', 'noopener')`,icon:"fal fa-external-link"}}};magistraal.sidebar.addFeed(s,a)}s.appendTo(t)})),magistraal.page.setContent(t,!0,e)}},tasks:{paintList:(a,e)=>{}},console:{info:a=>magistraal.console.send(a,"info",2500),error:(a="console.error.generic")=>magistraal.console.send(a,"error",-1),success:(a="console.success.generic")=>magistraal.console.send(a,"success",1500),loading:(a="console.loading.generic")=>magistraal.console.send(a,"loading",-1),clear:()=>{$(".console-message").remove()},send:(a,e="success",t=1500)=>{a=magistraal.locale.translate(a,magistraal.locale.translate(`console.${e}.generic`,a));let s=Date.now(),i={info:{icon:"info-circle",color:"var(--secondary)"},loading:{icon:"circle-notch fa-spin",color:"var(--secondary)"},debug:{icon:"info-circle",color:"var(--secondary)"},error:{icon:"exclamation-circle",color:"var(--danger)"},success:{icon:"check-circle",color:"var(--success)"}},l=i[e]||i.info;return $(".console-message").remove(),magistraal.element.get("console").prepend(`\n\t\t\t\t<div class="console-message d-flex flex-row" data-magistraal="console-message-${s}">\n\t\t\t\t\t<span class="console-message-icon"><i class="fal fa-${l.icon}" style="color: ${l.color};"></i></span>\n\t\t\t\t\t<span class="console-message-content">${a}</span>\n\t\t\t\t</div>\n\t\t\t`),t>=0&&setTimeout((()=>{magistraal.element.get(`console-message-${s}`).remove()}),t),s}},load:(a={})=>new Promise(((e,t)=>{try{isSet(a.version)||t(),magistraalPersistentStorage.get("version").value!=a?.version&&magistraalPersistentStorage.clear(!0);const s=magistraalPersistentStorage.get("settings").value;magistraal.api.call({url:"user/settings/get_all",source:"server_only",inBackground:!0}).then((e=>{magistraalPersistentStorage.set("user_uuid",e.data["system.user_uuid"]),magistraal.settings.updateClient(e.data),setTimeout((()=>{!0===a?.doPreCache&&parseInt(magistraal.settings.get("data_usage.prefer_level"))>0&&(magistraal.api.call({url:"appointments/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"grades/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"messages/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"messages/list",source:"server_only",data:{filter:["id"]},inBackground:!0,callback:magistraal.messages.paintBadge}),magistraal.api.call({url:"messages/sent",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"absences/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"account/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"messages/bin",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"grades/overview",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"sources/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"learningresources/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"studyguides/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"tasks/list",source:"prefer_cache",inBackground:!0}),magistraal.api.call({url:"settings/list",source:"prefer_cache",inBackground:!0}).then((a=>{$.each(a.data.items,(function(a,e){magistraal.api.call({url:"settings/list",data:{category:a},source:"prefer_cache",inBackground:!0})}))})));const e=magistraal.settings.get("appearance.theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(isSet(e)&&!e.includes("auto")||e.includes("auto")&&e==`${t}_auto`)return!1;magistraal.settings.set("appearance.theme",`${t}_auto`)}),25)}));const i=isSet(s)&&isSet(s["appearance.language"])?s["appearance.language"]:"nl_NL";magistraalStorage.set("version",a?.version),magistraalPersistentStorage.set("version",a?.version),magistraal.locale.load(i).then((()=>{$(document).trigger("magistraal.ready"),e()})).catch((()=>{magistraal.page.load({page:"offline"})}))}catch(a){t()}})),locale:{load:a=>new Promise(((e,t)=>{magistraal.api.call({url:"locale",data:{locale:a},source:"prefer_cache",callback:magistraal.locale.loadCallback,alwaysReturn:!0}).then((()=>{e()})).catch((()=>{t()}))})),loadCallback:(a,e)=>{magistraalStorage.set("translations",a.data),$("[data-translation]").each((function(){const a=$(this).attr("data-translation"),e=magistraal.locale.translate(a,"");"input"===this.tagName.toLowerCase()||"textarea"===this.tagName.toLowerCase()?$(this).attr("placeholder",e||$(this).attr("placeholder")||a):$(this).text(e||$(this).text()||a)}))},translate:(a,e)=>{isSet(e)||(e=a);let t=magistraalStorage.get("translations").value;return isSet(t)&&isSet(t[a])?t[a]:e},formatBoolean:a=>"1"==a||"yes"==a||"true"==a?magistraal.locale.translate("generic.bool.true","true"):"0"==a||"no"==a||"false"==a?magistraal.locale.translate("generic.bool.false","false"):"",formatDate:(a,e)=>{if("number"==typeof a?a=new Date(1e3*a):"string"==typeof a&&(a=new Date(a)),"object"!=typeof a)return!1;let t="",s=e.split("");return $.each(s,(function(e,s){switch(s){case"H":t+=addLeadingZero(a.getHours());break;case"i":t+=addLeadingZero(a.getMinutes());break;case"d":t+=a.getDate();break;case"l":t+=magistraal.locale.translate(`generic.day.${a.getDay()}`);break;case"m":t+=addLeadingZero(a.getMonth()+1);break;case"F":t+=magistraal.locale.translate(`generic.month.${a.getMonth()}`);break;case"Y":t+=a.getFullYear();break;default:t+=s;break}})),t},formatFileSize:(a,e=2)=>{const t=1e3;if(Math.abs(a)<t)return a+" B";const s=["KB","MB","GB","TB","PB","EB","ZB","YB"];let i=-1;const l=10**e;do{a/=t,++i}while(Math.round(Math.abs(a)*l)/l>=t&&i<s.length-1);return a.toFixed(e)+" "+s[i]}},nav:{open:()=>{$("body").attr("data-nav-active",!0),magistraalStorage.set("nav_active",!0)},close:()=>{$("body").attr("data-nav-active",!1),magistraalStorage.set("nav_active",!1)},toggle:()=>{"true"==magistraalStorage.get("nav_active").value?magistraal.nav.close():magistraal.nav.open()}},page:{load:a=>{if(isSet(a.data)||(a.data={}),!isSet(a.page))return!1;switch(isSet(a.source)||(a.source="both"),isSet(a.showBack)||(a.showBack=!1),isSet(a.unobtrusive)||(a.unobtrusive=!1),isSet(a.scope)||(a.scope=null),isSet(a.callback)||(a.callback=null),isSet(a.cachable)||(a.cachable="server_only"!=a.source),a.page.includes("?")&&([a.page,a.data]=a.page.split("?"),a.data=Object.fromEntries(new URLSearchParams(a.data))),a.page){case"login":case"main":case"offline":return void(window.location.href=`../${a.page}/`);case"sources/list":a.source="prefer_cache",a.cacheMaxAge=120;break;case"studyguides/info":case"studyguides/sources":a.source="prefer_cache",a.cacheMaxAge=120;break;case"settings/list":a.source="prefer_cache";break}magistraal.popup.close(),a.unobtrusive||(magistraal.sidebar.clearFeed(),magistraal.sidebar.close(),magistraal.element.get("page-search").val(""),magistraal.element.get("page-search-no-matches").removeClass("show"),magistraal.element.get("main").scrollTop(0)),a.showBack?(magistraal.page.pushState("backBtn",null,null),magistraal.page.modifyLocation(a.page,a.data,"replace")):magistraal.page.modifyLocation(a.page,a.data,"push");magistraal.element.get("responsive-carousel-indicator").removeClass("show"),$(".nav-item").removeClass("active"),magistraal.element.get(`nav-item-${a.page.split("/")[0]||null}`).addClass("active"),$("body").attr("disabled-data-history",$("body").attr("data-history")).removeAttr("data-history"),magistraal.page.get(a)},get:a=>{const e={"absences/list":magistraal.absences.paintList,"account/list":magistraal.account.paintList,"appointments/list":magistraal.appointments.paintList,"grades/list":magistraal.grades.paintList,"grades/overview":magistraal.grades.paintOverview,"grades/calculator":magistraal.grades.paintCalculator,"learningresources/list":magistraal.learningresources.paintList,"messages/list":magistraal.messages.paintList,"messages/sent":magistraal.messages.paintList,"messages/bin":magistraal.messages.paintList,logout:magistraal.logout.logout,"settings/list":magistraal.settings.paintList,"studyguides/info":magistraal.studyguides.paintDetails,"studyguides/sources":magistraal.sources.paintList,"studyguides/list":magistraal.studyguides.paintList,"sources/list":magistraal.sources.paintList,"tasks/list":magistraal.tasks.paintList};return new Promise(((t,s)=>{let i;if(isSet(a.callback)&&"function"==typeof a.callback)i=a.callback;else{if(!isSet(e[a.page]))return;i=e[a.page]}magistraal.console.loading("console.loading.refresh"),magistraal.api.call({url:a.page,data:a.data,source:a.source,cachable:a.cachable,scope:a.scope,callbackData:{showBack:a.showBack},callback:function(a,e,t,s,l){$("body").attr("data-history",$("body").attr("disabled-data-history")).removeAttr("disabled-data-history");const r=Math.max($('.list-item[data-interesting="true"][data-selected="true"]').index(),0);i(a,e,t,s),magistraal.page.getCallback(a,e,t,s,r)}}).then((a=>{t(a)})).catch((a=>{}))}))},getCallback:(a,e,t,s,i=0)=>{const l=magistraal.template.get(`page-buttons-${s}`),r=magistraal.element.get("page-buttons-container");if(r.attr("data-for-page")!=s){r.attr("data-for-page",s).html(l.length>=1?l.html():"");const a=magistraal.element.get("page-title"),e=magistraal.locale.translate(`generic.page.${s}.title`);a.text(e),document.title=`${e} | Magistraal`}"server_final"==e?magistraal.console.success("console.success.refresh"):"cache_final"==e&&magistraal.console.clear();const n=magistraal.element.get("page-search");n.value().length>0&&n.trigger("input"),magistraal.page.selectInterestingListItem(i,!0)},selectInterestingListItem:(a=0,e=!1)=>{if(e&&window.innerWidth<768)return;const t=magistraal.element.get("main").find(`.list-item[data-interesting="true"]:nth-child(${a+1})`);t.attr("data-ignore-event","click"),magistraalStorage.set("sidebar_locked",!0),t.click(),setTimeout((()=>{magistraalStorage.set("sidebar_locked",!1),t.removeAttr("data-ignore-event")}),10)},current:(a=!1)=>{const e=trim(window.location.hash.substring(2),"/");return a?e.split("?")[0]:e},reload:()=>{magistraal.page.load({page:magistraal.page.current(),unobtrusive:!0})},previous:()=>magistraalStorage.get("previousPage").value||"",setContent:(a,e=!0,t)=>{const s=magistraal.element.get("main"),i=e?a.children():a;s.scrollTop(),s.find('.responsive-carousel[data-carousel-direction="x"] .responsive-carousel-body').first().scrollLeft();s.empty().append(i),magistraal.element.get("page-search-no-matches").toggleClass("show",0==s.children().length)},pushState:(a,e,t)=>{window.history.pushState(a,e,t),$("body").attr("data-history","true")},back:(a=!0)=>{if(a&&window.history.back(),magistraal.page.previous().includes(magistraal.page.current().split("/")[0])&&magistraal.page.current().includes("?"))return!0;$("body").removeAttr("data-history")},modifyLocation:(a,e={},t="push")=>{$.each(e,(function(a,t){isSet(t)||delete e[a]}));const s=magistraal.page.current(!1,!1),i=new URLSearchParams(e).toString(),l=i.length>0?a.includes("?")?"&":"?":"",r=a+l+i;magistraalStorage.set("previousPage",magistraal.page.current()),$("body").attr("data-page",a),s!=r&&("push"==t?window.history.pushState(r,null,"#/"+r):"replace"==t&&window.history.replaceState(r,null,"#/"+r))}},login:{login:a=>{magistraal.console.loading("console.loading.login"),magistraal.api.call({url:"login",data:a,source:"server_only"}).then((a=>{isSet(a.data.user_uuid)&&magistraalPersistentStorage.set("user_uuid",a.data.user_uuid),window.location.href="../main/"})).catch((a=>{magistraal.console.error(`console.error.${a.responseJSON.info}`)}))}},inputs:{dialog:class{constructor(a={}){return isSet(a.title)||(a.title=""),isSet(a.description)||(a.description=""),isSet(a.defaultAnswer)||(a.defaultAnswer="no"),this.parameters=a,this}open(){return new Promise(((a,e)=>{if($(".dialog:not([data-magistraal-template]").length>0)return void e();this.$dialog=magistraal.template.get("dialog"),this.$dialog.find(".dialog-title").text(this.parameters.title),this.$dialog.find(".dialog-description").html(this.parameters.description),window.history.pushState("preventDialogClose",null,null),this.$dialog.appendTo("body"),setTimeout((()=>{this.$dialog.addClass("show")}),10),this.$dialog.find(`[data-dialog-action="${this.parameters.defaultAnswer}"]`).attr("data-selected",!0),magistraal.element.get("dialog-backdrop").addClass("show");const t=this;this.$dialog.find("[data-dialog-action]").on("click",(function(){"yes"==$(this).attr("data-dialog-action")?a():e(),t.close()}))}))}close(){if(!isSet(this.$dialog))return!1;window.history.back(),magistraal.element.get("dialog-backdrop").removeClass("show"),this.$dialog.removeClass("show"),setTimeout((()=>{this.$dialog.remove()}),250)}},tagsInput:class{constructor(a){this.$input=a,this.setup()}setup(){0==this.$input.closest(".input-wrapper").length&&this.$input.wrap('<div class="input-wrapper"></div>'),this.$input.data("tagsInput",this),this.$wrapper=this.$input.closest(".input-wrapper"),this.$wrapper.addClass("input-tags-wrapper"),this.$tags=$('<ul class="input-tags-list"></ul>'),this.$tags.appendTo(this.$wrapper),this.$wrapper.hasClass("input-search-wrapper")&&(this.$inputGhost=$('<input type="text" class="form-control input-search input-ghost">'),this.$inputGhost.appendTo(this.$wrapper),this.$tags.append(this.$input.removeClass("input-search").detach())),this.$wrapper.on("click",(a=>{this.eventFocus(a)})),$(document).on("click",(a=>{$(a.target).closest(".input-wrapper").is(this.$wrapper)||this.eventFocusOut(a)})),this.$input.on("magistraal.change",(a=>{this.eventChange(a)})),this.$input.on("keyup",(a=>{this.eventKeyup(a)}))}eventFocus(a){this.$inputGhost.addClass("focus")}eventFocusOut(a){setTimeout((()=>{this.$inputGhost.removeClass("focus")}),10)}eventChange(a){var e,t;null!=typeof a.addTag&&this.$input.addTag(null===(e=a.addTag)||void 0===e?void 0:e.value,null===(t=a.addTag)||void 0===t?void 0:t.text)}eventKeyup(a){if(8==a.which){let a=this.$tags.find(".input-tags-tag:last-of-type").attr("value");this.$input.removeTag(a)}}},searchInput:class{constructor(a){this.$input=a,this.setup()}setup(){0==this.$input.closest(".input-wrapper").length&&this.$input.wrap('<div class="input-wrapper dropdown"></div>'),this.$input.data("searchInput",this),this.$input.attr("autocomplete","off"),this.$wrapper=this.$input.closest(".input-wrapper"),this.$wrapper.addClass("input-search-wrapper"),this.$results=$('<ul class="input-search-results dropdown-menu dropdown-menu-full-width"></ul>'),this.$results.append(`<li class="input-search-result dropdown-item">${magistraal.locale.translate("generic.search.no_matches")}</li>`),this.$results.appendTo(this.$wrapper),this.$input.attr("placeholder")||this.$input.attr("placeholder",magistraal.locale.translate("generic.action.search")),this.$wrapper.on("click",(a=>{this.eventFocus(a)})),$(document).on("click",(a=>{$(a.target).closest(".input-wrapper").is(this.$wrapper)||this.eventFocusOut(a)})),isSet(this.$input.attr("data-magistraal-search-api"))?(this.$input.on("input",(a=>{this.eventInput(a)})),this.$input.attr("data-magistraal-target","magistraal-input-results")):this.$input.on("input",debounce((a=>{this.eventInput(a)}),250)),this.$results.on("click",".input-search-result",(a=>{this.eventResultClick(a)}))}eventFocus(a){this.$wrapper.addClass("active")}eventFocusOut(a){setTimeout((()=>{this.$wrapper.removeClass("active")}),10)}eventInput(a){if(isSet(this.$input.attr("data-magistraal-search-api"))){const a=this.$input.attr("data-magistraal-search-api"),e=this.$input.val()||this.$input.text();magistraal.api.call({url:`${a}/search`,data:{query:e},cachable:!1}).then((e=>{const t=magistraal.inputs.search.remap_api_response(a,e);this.results.set(t)})).catch((a=>{}))}}eventResultClick(a){let e=$(a.target).closest(".input-search-result"),t=e.attr("value"),s=e.find(".input-search-result-title").text()||e.text();if(this.$input.val(""),this.results.select(t),this.$wrapper.hasClass("input-tags-wrapper")){this.$wrapper.find(".input-tags").trigger({type:"magistraal.change",addTag:{value:t,text:s}})}else this.$input.val(s).attr("data-value",t),this.$input.trigger("magistraal.change");this.eventFocusOut()}results={set:a=>{let e="";$.each(a,(function(a,t){isSet(t.icon)&&isSet(t.description)?e+=`<li class="input-search-result input-search-result-rich dropdown-item" value="${t?.value}"><i class="input-search-result-icon ${t?.icon}"></i><span class="input-search-result-title">${t?.title}</span><span class="input-search-result-description">${t?.description}</span></li>`:e+=`<li class="input-search-result dropdown-item" value="${t?.value}"><span class="input-search-result-title">${t?.title}</span></li>`})),this.$results.find(".input-search-result[value]").remove(),this.$results.prepend(e)},select:a=>{this.$results.find(".input-search-result").removeAttr("data-selected"),this.$results.find(`.input-search-result[value="${a}"]`).attr("data-selected",!0)}}},search:{remap_api_response:(a,e)=>{let t=[];switch(a){case"people":$.each(e.data,(function(a,e){t.push({icon:"student"==e.type?"fal fa-book-open":"fal fa-briefcase",title:""==e.infix?`${e.first_name} ${e.last_name}`:`${e.first_name} ${e.infix} ${e.last_name}`,description:e.course||e.code||magistraal.locale.translate(`people.type.${e.type}`),value:e.id})}));break;case"tenants":$.each(e.data,(function(a,e){t.push({icon:"fal fa-school",title:e.name,description:e.name,value:e.id})}));break}return t}}},logout:{logout:()=>{magistraal.api.call({url:"logout",source:"server_only"}).finally((()=>{magistraalPersistentStorage.clear(),magistraal.page.load({page:"login"})}))}},sidebar:{addFeed:(a,e)=>(e.title=e.title||"",e.subtitle=e.subtitle||"",e.table=e.table||{},e.actions=e.actions||{},e.id=e.id||0,(a=a||magistraal.element.get("sidebar")).attr("data-sidebar-feed",encodeURI(JSON.stringify(e))),!0),clearFeed:()=>magistraal.sidebar.selectFeed(void 0),getFeed:a=>(a=a||magistraal.element.get("sidebar"),JSON.parse(decodeURI(a.attr("data-sidebar-feed")||"{}"))),selectFeed:(a,e=!0)=>{if(!isSet(a))return magistraal.sidebar.setFeed(void 0,!1);$(`[class="${a.attr("class")}"]`).removeAttr("data-selected"),a.attr("data-selected",!0),magistraal.sidebar.setFeed(magistraal.sidebar.getFeed(a),e)},setFeed:(a={title:"",subtitle:"",table:{},actions:{}},e=!0)=>{let t=magistraal.element.get("sidebar-table"),s=magistraal.element.get("sidebar-actions");magistraal.element.get("sidebar-title").text(a.title),magistraal.element.get("sidebar-subtitle").text(a.subtitle),t.empty(),s.empty(),magistraal.sidebar.addFeed(void 0,a),$.each(a.table,(function(a,e){if(""==a||""==e)return!0;let s=magistraal.template.get("sidebar-table-key");s.attr("data-key",a).text(magistraal.locale.translate(`sidebar.table.info.${a}`)),s.appendTo(t);let i=magistraal.template.get("sidebar-table-value");i.html(e),i.appendTo(t)})),$.each(a.actions,(function(a,e){let t=magistraal.template.get("sidebar-action"),i=magistraal.mapping.colors("sidebar_action",a);t.addClass(`btn-${i} online-only`),t.html(`\n\t\t\t\t\t<i class="btn-icon ${e?.icon}"></i>\n\t\t\t\t\t<span class="btn-text">${magistraal.locale.translate(`generic.action.${a}`)}</span>\n\t\t\t\t`),t.attr({"data-action":a,onclick:e?.handler}),t.appendTo(s)})),magistraalStorage.set("sidebarId",a.id),e&&magistraal.sidebar.open()},updateFeed:(a,e)=>{let t={id:"",title:"",subtitle:"",table:{},actions:{}},s=magistraal.sidebar.getFeed(),i=Object.keys(s.table).length;if(t.title=a?.title||s.title,t.subtitle=a?.subtitle||s.subtitle,t.id=a?.id||s.id,Object.keys(s.table).length>0){let l=1;$.each(s.table,(function(s,r){t.table[s]=r,s!=e&&l!=i||$.each(a.table,(function(a,e){t.table[a]=e})),l++}))}else t.table=a.table;Object.assign(t.actions,s.actions,a?.actions),magistraal.sidebar.setFeed(t,!1)},currentFeed(){let a=magistraal.element.get("sidebar");return JSON.parse(decodeURI(a.attr("data-sidebar-feed")||"{}"))},open:()=>!0!==magistraalStorage.get("sidebar_locked").value&&(!0!==magistraalStorage.get("sidebar_active").value&&(window.innerWidth<768&&magistraal.page.pushState("preventSidebarClose",null,null),$("body").attr("data-sidebar-active",!0),void magistraalStorage.set("sidebar_active",!0))),close:(a=!1)=>!0!==magistraalStorage.get("sidebar_locked").value&&(!1!==magistraalStorage.get("sidebar_active").value&&(a&&window.history.back(),$("body").attr("data-sidebar-active",!1),void magistraalStorage.set("sidebar_active",!1))),toggle:()=>{"true"==magistraalStorage.get("sidebar_active").value?magistraal.sidebar.close():magistraal.sidebar.open()},actionStarted:a=>{$(`.sidebar-action[data-action="${a}"]`).attr("disabled","true")},actionEnded:(a,e)=>{setTimeout((()=>{$(`.sidebar-action[data-action="${a}"]`).removeAttr("disabled"),e&&(magistraal.page.selectInterestingListItem(0,!0),magistraal.sidebar.close())}),10)},getId:(a=null)=>magistraalStorage.get("sidebarId").value||a||0},popup:{get:a=>$(`[data-magistraal-popup="${a}"]`).first(),open:a=>{let e=magistraal.popup.get(a);if(0===e.length)return!1;window.history.pushState("preventPopupClose",null,null),magistraal.element.get("popup-backdrop").addClass("show"),magistraal.popup.enable(a),e.addClass("show")},close:(a,e=!0,t=!1)=>{isSet(a)||(a=$("[data-magistraal-popup].show").last().attr("data-magistraal-popup"));let s=magistraal.popup.get(a);if(0===s.length)return!1;if(magistraal.element.get("popup-backdrop").removeClass("show"),magistraal.popup.disable(a),s.removeClass("show"),t){const a=s.find("form").first();a.length&&setTimeout((()=>{a.formReset()}),250)}e&&window.history.back()},enable:a=>{magistraal.popup.get(a).find("[data-popup-action]").removeAttr("disabled")},disable:a=>{magistraal.popup.get(a).find("[data-popup-action]").attr("disabled","disabled")}},template:{get:a=>$(`[data-magistraal-template="${a}"]`).first().clone().removeAttr("data-magistraal-template")},element:{get:a=>$(`[data-magistraal="${a}"]`)},token:{isSet:()=>""!=getCookie("magistraal-authorization"),delete:()=>(setCookie("magistraal-authorization",void 0,-1),!0)},mapping:{icons:(a="",e="")=>{switch(e=e.toLowerCase(),a){case"file_icons":return"application/msword"==e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==e?"fal fa-file-word":"application/vnd.ms-powerpoint"==e||"application/vnd.openxmlformats-officedocument.presentationml.presentation"==e?"fal fa-file-powerpoint":"application/vnd.ms-excel"==e||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e?"fal fa-file-excel":"application/pdf"==e?"fal fa-file-pdf":e.includes("image/")?"fal fa-file-image":e.includes("video/")?"fal fa-file-video":e.includes("audio/")?"fal fa-file-audio":e.includes("text/")?"fal fa-file-alt":"application/zip"==e||"application/x-zip-compressed"==e||"application/x-7z-compressed"==e||"application/vnd.rar"==e||"application/x-bzip"==e||"application/x-bzip2"==e?"fal fa-file-archive":"folder"==e?"fal fa-folder":"link"==e?"fal fa-paperclip":"fal fa-file";case"subject_icons":return e.includes("aard")?"fal fa-globe-africa":e.includes("nederland")?"fal fa-flower-tulip":e.includes("frans")?"fal fa-wine-glass-alt":e.includes("engels")?"fal fa-mug-tea":e.includes("duits")?"fal fa-beer":e.includes("spaans")?"fal fa-skull-cow":e.includes("wis")?"fal fa-calculator-alt":e.includes("geschie")?"fal fa-castle":e.includes("latijn")?"fal fa-university":e.includes("grieks")?"fal fa-omega":e.includes("rekenen")?"fal fa-abacus":e.includes("maatschap")?"fal fa-users":e.includes("licha")?"fal fa-running":e.includes("schei")?"fal fa-flask":e.includes("biol")?"fal fa-leaf":e.includes("natuur")?"fal fa-atom":e.includes("bedrijfseco")?"fal fa-coins":e.includes("eco")?"fal fa-coin":"fal fa-school";case"account_items_icons":if("full_name"==e)return"fal fa-user";if("full_name_official"==e)return"fal fa-address-card";if("phone"==e)return"fal fa-phone-alt";if("email"==e)return"fal fa-envelope";if("residence"==e)return"fal fa-home"}return"fal fa-question"},translations:(a="",e="")=>{switch(a){case"file_types":return"application/msword"==e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==e?magistraal.locale.translate("generic.file_type.word"):"application/vnd.ms-powerpoint"==e||"application/vnd.openxmlformats-officedocument.presentationml.presentation"==e?magistraal.locale.translate("generic.file_type.powerpoint"):"application/vnd.ms-excel"==e||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e?magistraal.locale.translate("generic.file_type.excel"):"application/pdf"==e?magistraal.locale.translate("generic.file_type.pdf"):e.includes("image/")?magistraal.locale.translate("generic.file_type.image"):e.includes("video/")?magistraal.locale.translate("generic.file_type.video"):e.includes("audio/")?magistraal.locale.translate("generic.file_type.audio"):e.includes("text/")?magistraal.locale.translate("generic.file_type.text"):"application/zip"==e||"application/x-zip-compressed"==e||"application/x-7z-compressed"==e||"application/vnd.rar"==e||"application/x-bzip"==e||"application/x-bzip2"==e?magistraal.locale.translate("generic.file_type.archive"):"folder"==e?magistraal.locale.translate("generic.file_type.folder"):magistraal.locale.translate("generic.file_type.file")}return""},colors:(a="",e="")=>{switch(a){case"sidebar_action":switch(e){case"delete":return"danger";case"join_meeting":return"teams";case"finish":return"success";default:return"secondary"}}}}};